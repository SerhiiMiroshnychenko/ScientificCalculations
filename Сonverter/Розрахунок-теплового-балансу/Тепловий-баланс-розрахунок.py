#!/usr/bin/env python
# coding: utf-8

# # Розрахунок теплового балансу киснево-конвертерної плавки
# ## Частина 1: Вступ та основні константи
# 
# У цьому документі представлена методика розрахунку теплового балансу киснево-конвертерної плавки. Тепловий баланс плавки включає надходження та витрати тепла, які повинні бути збалансовані для отримання сталі із заданою температурою.
# 
# ### Основи теплового балансу
# 
# Тепловий баланс плавки базується на законі збереження енергії, за яким сума усіх видів енергії в ізольованій системі є постійною. В киснево-конвертерному процесі надходження тепла складається з фізичного тепла чавуну, міксерного шлаку, тепла від окислення домішок металошихти, окислення заліза та шлакоутворення.
# 
# Витрати тепла включають тепло, що уносить рідка сталь, шлак, конвертерні гази, тепло дисоціації оксидів, теплові втрати та інше.
# 
# ### Основні константи для розрахунку
# 
# Нижче наведено всі константи, необхідні для розрахунку теплового балансу:
# 

# In[29]:


# -*- coding: utf-8 -*-
# Автоматичний розрахунок теплового балансу для обраного варіанту

# ================= КОНСТАНТИ =================

# Коефіцієнти для розрахунку фізичного тепла чавуну (кДж/кг)
CHAV_COEFFICIENT_1 = 61.9  # Перший коефіцієнт рівняння
CHAV_COEFFICIENT_2 = 0.88  # Температурний коефіцієнт (кДж/кг·°C)

# Коефіцієнти для розрахунку тепла міксерного шлаку
PERCENT_DIVISOR = 100  # Дільник для переведення відсотків у частки
MSH_COEFFICIENT_1 = 1.53  # Температурний коефіцієнт (кДж/кг·°C)
MSH_OFFSET = 710  # Тепловий зсув (кДж/кг)

# Коефіцієнти для розрахунку тепла окислення домішок (кДж/кг)
C_TO_CO_HEAT = 11680  # Тепловий ефект окислення вуглецю до CO (кДж/кг)
C_TO_CO2_HEAT = 35300  # Тепловий ефект окислення вуглецю до CO2 (кДж/кг)
SI_HEAT = 26930  # Тепловий ефект окислення кремнію (кДж/кг)
MN_HEAT = 7035  # Тепловий ефект окислення марганцю (кДж/кг)
P_HEAT = 19755  # Тепловий ефект окислення фосфору (кДж/кг)

# Коефіцієнти для розрахунку тепла окислення заліза (кДж/кг)
FEO_HEAT = 3600  # Тепловий ефект утворення FeO (кДж/кг)
FE2O3_HEAT = 5110  # Тепловий ефект утворення Fe2O3 (кДж/кг)

# Коефіцієнти для розрахунку тепла шлакоутворення (кДж/кг)
SIO2_HEAT = 2300  # Тепловий ефект утворення SiO2 у шлаку (кДж/кг)
P2O5_HEAT = 4886  # Тепловий ефект утворення P2O5 у шлаку (кДж/кг)

# Коефіцієнти для розрахунку тепла рідкої сталі (кДж/кг)
ST_COEFFICIENT_1 = 54.8  # Перший коефіцієнт рівняння
ST_COEFFICIENT_2 = 0.84  # Температурний коефіцієнт (кДж/кг·°C)

# Коефіцієнти для розрахунку тепла шлаку (кДж/кг)
SHL_COEFFICIENT = 2.09  # Температурний коефіцієнт (кДж/кг·°C)
SHL_OFFSET = 1380  # Тепловий зсув (кДж/кг)

# Коефіцієнти для розрахунку тепла пилу (кДж/кг)
PIL_COEFFICIENT_1 = 23.05  # Перший коефіцієнт рівняння
PIL_COEFFICIENT_2 = 0.69  # Температурний коефіцієнт (кДж/кг·°C)
AVERAGE_DIVISOR = 2  # Дільник для розрахунку середньої температури

# Коефіцієнти для розрахунку тепла викидів, корольків та виплесків (кДж/кг)
VKV_COEFFICIENT_1 = 54.9  # Перший коефіцієнт рівняння
VKV_COEFFICIENT_2 = 0.838  # Температурний коефіцієнт (кДж/кг·°C)

# Коефіцієнти для розрахунку теплових втрат
VTR_PERCENT = 5  # Відсоток теплових втрат від загального надходження тепла

# Коефіцієнти для розрахунку тепла конвертерних газів
MOLAR_VOLUME = 22.4  # Мольний об'єм газу при нормальних умовах (л/моль)
CAL_TO_J = 41868  # Коефіцієнт переведення калорій в джоулі (Дж/ккал)

# Коефіцієнт для розрахунку тепла дисоціації карбонату кальцію (кДж/кг)
CACO3_HEAT = 4040  # Теплота дисоціації карбонату кальцію (кДж/кг)

# Коефіцієнти для переведення відсотків у фізичні величини
PERCENT_TO_FRACTION = 0.01  # Коефіцієнт для переведення % в частки (1/100)

# Теплові ефекти палива (кДж/кг)
SIC_HEAT = 17000  # Карбід кремнію
CAC2_HEAT = 10680  # Карбід кальцію
COAL_HEAT = 32000  # Антрацит
BIOMASS_HEAT = 21500  # Піролізована біомаса

# Додаткові матеріальні константи
FEO_MSH = 0.8  # % FeO в міксерному шлаку
FEO_OK = 0.5  # % FeO в окатишах
FE2O3_FUT = 1.0  # % Fe2O3 у футерівці
FE2O3_OK = 0.3  # % Fe2O3 в окатишах
CO2_VAP = 5  # % CO2 у вапні

# Константи значень, однакових для всіх варіантів
M_OKAT = 0.1  # Маса окатишів
M_FUT = 0.13  # Маса футерівки
T_SHL = 1600  # Температура шлаку
FEO = 10  # Вміст оксиду заліза FeO
FE2O3 = 1  # Вміст оксиду заліза Fe₂O₃
SIO2 = 10  # Вміст діоксиду кремнію
P2O5 = 1  # Вміст пентаоксиду фосфору
ALPHA = 0.1  # Коефіцієнт alpha
A_COEF = 100  # Коефіцієнт a (частка міксерного шлаку)
C_COEF = 100  # Коефіцієнт c (частка окатишів)


# ### Теплові ефекти реакцій окиснення
# 
# Для розрахунку теплового балансу важливо знати теплові ефекти реакцій окислення елементів. Нижче наведено стандартні теплові ефекти основних реакцій:
# 
# | Реакція | Стандартний тепловий ефект реакції |
# | :----------------------------------------- | :-------------------------------------------------------: |
# | $[\text{C}] + \{\text{O}_2\} = \{\text{CO}_2\}$ | 7236 ккал/кг C |
# | $[\text{Si}] + \{\text{O}_2\} = \{\text{SiO}_2\}$ | 6075 ккал/кг Si |
# | $2[\text{P}] + 5/2\{\text{O}_2\} = \{\text{P}_2\text{O}_5\}$ | 3621 ккал/кг P |
# | $[\text{C}] + 1/2\{\text{O}_2\} = \{\text{CO}\}$ | 2220 ккал/кг C |
# | $2[\text{Cr}] + 3/2\{\text{O}_2\} = \{\text{Cr}_2\text{O}_3\}$ | 2208 ккал/кг Cr |
# | $2[\text{Fe}] + 3/2\{\text{O}_2\} = \{\text{Fe}_2\text{O}_3\}$ | 1608 ккал/кг Fe |
# | $[\text{Mn}] + 1/2\{\text{O}_2\} = \{\text{MnO}\}$ | 1390 ккал/кг Mn |
# | $[\text{Fe}] + 1/2\{\text{O}_2\} = \{\text{FeO}\}$ | 920 ккал/кг Fe |
# 
# Примітка: Квадратними дужками позначено елементи, що знаходяться у розчині в металі, фігурними - газоподібні речовини та їх розчини в шлаку.

# # Розрахунок теплового балансу киснево-конвертерної плавки
# ## Частина 2: Вхідні дані та варіанти
# 
# ### Вхідні дані для розрахунку
# 
# У таблиці нижче наведені варіанти вхідних даних для розрахунку теплового балансу. Кожен варіант містить інформацію про склад чавуну, сталі, та інші технологічні параметри.
# 
# #### Таблиця варіантів розрахунку

# In[30]:


# "Таблиця-варантів" (скопійовано у вигляді списку словників)
variants = [
    {"M_чав": 71.8, "M_ст": 87.5, "M_шл": 16.0, "M_м.бр": 17.7, "M_м.ш": 1.3, "M_пил": 0.9, "Fe_vtr": 4.5, "t_чав": 1350, "t_ст": 1595},
    {"M_чав": 70.0, "M_ст": 85.0, "M_шл": 15.0, "M_м.бр": 5.0, "M_м.ш": 1.2, "M_пил": 0.85, "Fe_vtr": 4.2, "t_чав": 1335, "t_ст": 1630},
    {"M_чав": 72.0, "M_ст": 88.0, "M_шл": 16.5, "M_м.бр": 10.8, "M_м.ш": 1.3, "M_пил": 0.92, "Fe_vtr": 4.6, "t_чав": 1380, "t_ст": 1620},
    {"M_чав": 71.0, "M_ст": 86.5, "M_шл": 15.8, "M_м.бр": 7.9, "M_м.ш": 1.2, "M_пил": 0.87, "Fe_vtr": 4.3, "t_чав": 1360, "t_ст": 1620},
    {"M_чав": 70.5, "M_ст": 85.8, "M_шл": 15.5, "M_м.бр": 5.7, "M_м.ш": 1.2, "M_пил": 0.85, "Fe_vtr": 4.2, "t_чав": 1340, "t_ст": 1590},
    {"M_чав": 72.2, "M_ст": 88.2, "M_шл": 16.6, "M_м.бр": 8.1, "M_м.ш": 1.3, "M_пил": 0.93, "Fe_vtr": 4.7, "t_чав": 1390, "t_ст": 1620},
    {"M_чав": 70.8, "M_ст": 86.2, "M_шл": 15.7, "M_м.бр": 8.5, "M_м.ш": 1.2, "M_пил": 0.86, "Fe_vtr": 4.3, "t_чав": 1320, "t_ст": 1620},
    {"M_чав": 71.5, "M_ст": 87.0, "M_шл": 15.9, "M_м.бр": 7.2, "M_м.ш": 1.2, "M_пил": 0.88, "Fe_vtr": 4.4, "t_чав": 1370, "t_ст": 1600},
    {"M_чав": 71.2, "M_ст": 86.7, "M_шл": 15.8, "M_м.бр": 9.3, "M_м.ш": 1.2, "M_пил": 0.87, "Fe_vtr": 4.3, "t_чав": 1380, "t_ст": 1620},
    {"M_чав": 70.9, "M_ст": 86.3, "M_шл": 15.6, "M_м.бр": 9.5, "M_м.ш": 1.2, "M_пил": 0.86, "Fe_vtr": 4.3, "t_чав": 1380, "t_ст": 1590},
    {"M_чав": 70.0, "M_ст": 85.0, "M_шл": 15.0, "M_м.бр": 1.8, "M_м.ш": 1.2, "M_пил": 0.85, "Fe_vtr": 4.2, "t_чав": 1300, "t_ст": 1590},
    {"M_чав": 71.7, "M_ст": 87.7, "M_шл": 16.1, "M_м.бр": 7.7, "M_м.ш": 1.3, "M_пил": 0.91, "Fe_vtr": 4.6, "t_чав": 1370, "t_ст": 1610},
    {"M_чав": 70.2, "M_ст": 85.2, "M_шл": 15.1, "M_м.бр": 0.9, "M_м.ш": 1.2, "M_пил": 0.85, "Fe_vtr": 4.2, "t_чав": 1350, "t_ст": 1625},
    {"M_чав": 70.6, "M_ст": 85.6, "M_шл": 15.3, "M_м.бр": 1.3, "M_м.ш": 1.2, "M_пил": 0.85, "Fe_vtr": 4.2, "t_чав": 1300, "t_ст": 1600},
    {"M_чав": 71.3, "M_ст": 86.8, "M_шл": 15.9, "M_м.бр": 9.6, "M_м.ш": 1.2, "M_пил": 0.87, "Fe_vtr": 4.3, "t_чав": 1380, "t_ст": 1620},
]


# Де:
# - `M_чав` - маса рідкого чавуну, кг
# - `M_ст` - маса рідкої сталі, кг
# - `M_шл` - маса шлаку, кг
# - `M_м.бр` - маса металобрухту, кг
# - `M_м.ш` - маса міксерного шлаку, кг
# - `M_пил` - маса пилу, кг
# - `Fe_vtr` - втрати заліза (викиди, корольки в шлаку, виплески), кг
# - `t_чав` - температура чавуну, °C
# - `t_ст` - температура сталі, °C
# 
# ### Склад чавуну та сталі
# 
# Нижче наведено таблиці вмісту основних елементів у чавуні та готовій сталі для різних варіантів розрахунку.
# 
# #### Таблиця: Склад чавуну в %
# 
# | № з/п | C    | Si   | Mn   | P    | S    | Додатковий тип металобрухту | Вага, кг\* |
# | :---- | :--- | :--- | :--- | :--- | :--- | :-------------------------- | :--------- |
# | 1     | 4,32 | 0,83 | 1,00 | 0,17 | 0,05 | чушковий чавун              | 17,7       |
# | 2     | 4,65 | 0,94 | 0,95 | 0,16 | 0,06 | скрап                       | 5,0        |
# | 3     | 4,45 | 0,88 | 1,15 | 0,17 | 0,045| чушковий чавун              | 10,8       |
# | 4     | 4,60 | 0,73 | 0,98 | 0,18 | 0,05 | кременистий лом            | 7,9        |
# | 5     | 4,25 | 0,82 | 1,08 | 0,15 | 0,045| чушковий чавун              | 5,7        |
# | 6     | 4,40 | 0,85 | 1,13 | 0,20 | 0,05 | кременистий лом            | 8,1        |
# | 7     | 4,70 | 0,91 | 0,98 | 0,20 | 0,040| чушковий чавун              | 8,5        |
# | 8     | 4,35 | 0,80 | 1,05 | 0,19 | 0,05 | скрап                       | 7,2        |
# | 9     | 4,29 | 0,78 | 1,13 | 0,18 | 0,05 | кременистий лом            | 9,3        |
# | 10    | 4,70 | 0,83 | 0,73 | 0,12 | 0,05 | скрап                       | 9,5        |
# | 11    | 4,25 | 0,35 | 1,08 | 0,15 | 0,045| окатиші                     | 1,8        |
# | 12    | 4,40 | 0,30 | 1,13 | 0,20 | 0,05 | кременистий лом            | 7,7        |
# | 13    | 4,70 | 0,32 | 0,98 | 0,2  | 0,04 | окатиші                     | 0,9        |
# | 14    | 4,35 | 0,44 | 1,05 | 0,19 | 0,05 | окатиші                     | 1,3        |
# | 15    | 4,29 | 0,41 | 1,13 | 0,18 | 0,05 | кременистий лом            | 9,6        |
# 
# \* Вага додаткового металобрухту вказана на 100 кг рідкого чавуну.
# 
# #### Таблиця: Склад готової сталі в %
# 
# | № з/п | C             | Si            | Mn            | P    | S    | Температура, °С |
# | :---- | :------------ | :------------ | :------------ | :--- | :--- | :-------------- |
# |       |               |               |               |      |      | чавуну | сталі |
# | 1     | 0,38÷0,46    | 0,20÷0,30    | 0,58÷0,78    | 0,04 | 0,04 | 1350   | 1595  |
# | 2     | 0,08÷0,16    | сліди         | 0,33÷0,53    | 0,05 | 0,04 | 1335   | 1630  |
# | 3     | 0,15÷0,23    | 0,19÷0,29    | 0,44÷0,64    | 0,04 | 0,05 | 1380   | 1620  |
# | 4     | 0,13÷0,21    | 0,18÷0,28    | 0,40÷0,60    | 0,05 | 0,05 | 1360   | 1620  |
# | 5     | 0,30÷0,38    | 0,18÷0,28    | 0,48÷0,68    | 0,045| 0,04 | 1340   | 1590  |
# | 6     | 0,14÷0,22    | 0,16÷0,26    | 0,36÷0,56    | 0,05 | 0,04 | 1390   | 1620  |
# | 7     | 0,08÷0,16    | сліди         | 0,30÷0,50    | 0,05 | 0,04 | 1320   | 1620  |
# | 8     | 0,20÷0,28    | 0,14÷0,24    | 0,46÷0,66    | 0,04 | 0,04 | 1370   | 1600  |
# | 9     | 0,10÷0,18    | 0,18÷0,28    | 0,40÷0,60    | 0,05 | 0,05 | 1380   | 1620  |
# | 10    | 0,25÷0,33    | 0,20÷0,30    | 0,60÷0,80    | 0,04 | 0,04 | 1380   | 1590  |
# | 11    | 0,30÷0,38    | 0,18÷0,28    | 0,48÷0,68    | 0,045| 0,04 | 1300   | 1590  |
# | 12    | 0,14÷0,22    | 0,16÷0,26    | 0,36÷0,56    | 0,05 | 0,04 | 1370   | 1610  |
# | 13    | 0,08÷0,16    | сліди         | 0,30÷0,50    | 0,05 | 0,04 | 1350   | 1625  |
# | 14    | 0,20÷0,28    | 0,14÷0,24    | 0,46÷0,66    | 0,04 | 0,04 | 1300   | 1600  |
# | 15    | 0,10÷0,18    | 0,18÷0,28    | 0,40÷0,60    | 0,05 | 0,05 | 1380   | 1620  |
# 
# ### Хімічний склад додаткових матеріалів
# 
# #### Таблиця: Хімічний склад додаткового металобрухту
# 
# | Матеріал             | C   | Si  | Mn  | P    | S     |
# | :------------------- | :-- | :-- | :-- | :--- | :---- |
# | Твердий чавун        | 3,9 | 0,8 | 0,6 | 0,1  | 0,045 |
# | Кременистий брухт    | 0,2 | 7   | 0,5 | 0,04 | 0,05  |
# | Скрап (металева склад) | 0,2 | 0   | 0,5 | 0,04 | 0,05  |
# 
# ### Теплоємності газів
# 
# Для розрахунку тепла, що уносять конвертерні гази, використовуються дані по теплоємності газів:
# 
# #### Таблиця: Теплоємності деяких газів $c_p = a + bT + cT^{-2}$
# 
# | Газ   | a     | b·10³ | c·10⁻⁵ | ΔT, К      |
# | :---- | :---- | :---- | :----- | :--------- |
# | CO    | 6,79  | 0,98  | -0,11  | 298 ÷ 2500 |
# | CO₂   | 10,55 | 2,16  | -2,04  | 298 ÷ 2500 |
# | CH₄   | 5,65  | 11,44 | -0,46  | 298 ÷ 1500 |
# | H₂    | 27,30 | 3,27  | 0,50   | 298 ÷ 3000 |
# | H₂O   | 18,03 | -     | -      | 273 ÷ 373  |
# | N₂    | 6,66  | 1,02  | -      | 298 ÷ 2500 |
# | O₂    | 7,16  | 1,0   | -0,40  | 298 ÷ 3000 |

# In[31]:


# Об'єми газів
V_gi = {
    'CO': 0.85,  # м³
    'CO2': 0.11,  # м³
    'N2': 0.02,  # м³
    'O2': 0.02   # м³
}

# Коефіцієнти теплоємності газів
gas_coefs = {
    'CO': {'a': 6.79, 'b': 0.98, 'c': -0.11},
    'CO2': {'a': 10.55, 'b': 2.16, 'c': -2.04},
    'N2': {'a': 6.66, 'b': 1.02, 'c': 0},
    'O2': {'a': 7.16, 'b': 1.0, 'c': -0.40}
}


# In[32]:


# Склад чавуну
C_metsh = 4.3    # Вміст вуглецю в металошихті
Si_metsh = 0.4   # Вміст кремнію в металошихті
Mn_metsh = 1.1   # Вміст марганцю в металошихті
P_metsh = 0.18   # Вміст фосфору в металошихті
C_pov = 0.2      # Вміст вуглецю у готовій сталі
Mn_pov = 0.2     # Вміст марганцю у готовій сталі
P_pov = 0.02     # Вміст фосфору у готовій сталі


# ### Вибір варіанту для розрахунку
# 
# Для виконання розрахунків теплового балансу необхідно вибрати один з варіантів вхідних даних. Цей варіант буде використовуватись у всіх наступних розрахунках.

# In[33]:


# Вибір варіанту для розрахунку
var_num = int(input("Введіть номер варіанту (від 1 до 15): "))
variant_index = var_num - 1  # Індекс у масиві на 1 менший за номер варіанту

# Перевірка коректності введеного номера
if variant_index < 0 or variant_index >= len(variants):
    print(f"Помилка: Варіант {var_num} не існує. Використовуємо варіант 1.")
    variant_index = 0
    var_num = 1

# Обраний варіант, який буде використовуватись у всіх розрахунках
selected_variant = variants[variant_index]

print(f"\nВибрано варіант {var_num}:")
print(f"Маса чавуну: {selected_variant['M_чав']} кг")
print(f"Маса сталі: {selected_variant['M_ст']} кг")
print(f"Маса шлаку: {selected_variant['M_шл']} кг")
print(f"Маса металобрухту: {selected_variant['M_м.бр']} кг")
print(f"Маса міксерного шлаку: {selected_variant['M_м.ш']} кг")
print(f"Маса пилу: {selected_variant['M_пил']} кг")
print(f"Втрати заліза: {selected_variant['Fe_vtr']} кг")
print(f"Температура чавуну: {selected_variant['t_чав']} °C")
print(f"Температура сталі: {selected_variant['t_ст']} °C")


# # Розрахунок теплового балансу киснево-конвертерної плавки
# ## Частина 3: Надходження тепла - рідкий чавун і міксерний шлак
# 
# ### 3.1 Фізичне тепло рідкого чавуну
# 
# Рідкий чавун є основним джерелом фізичного тепла в киснево-конвертерному процесі. Його внесок у загальне надходження тепла в процес дуже суттєвий. Згідно з методикою, розрахунок тепла, яке вносить рідкий чавун, виконується за формулою (5.62):
# 
# $$Q_{чав} = M_{чав} \cdot (61.9 + 0.88 \cdot t_{чав}), \text{ кДж}.$$
# 
# де:
# - $M_{чав}$ - маса рідкого чавуну, кг;
# - $t_{чав}$ - температура рідкого чавуну, °С;
# - $61.9$ і $0.88$ - коефіцієнти рівняння.
# 
# #### Програмна реалізація розрахунку фізичного тепла чавуну:

# In[34]:


def Q_chav(M_chav, t_chav):
    """
    Розрахунок фізичного тепла, що вносить рідкий чавун.

    Параметри:
    M_chav - маса рідкого чавуну, кг
    t_chav - температура рідкого чавуну, °C

    Повертає:
    Кількість тепла в кДж
    """
    return M_chav * (CHAV_COEFFICIENT_1 + CHAV_COEFFICIENT_2 * t_chav)


# ### 3.2 Тепло міксерного шлаку
# 
# Міксерний шлак, який потрапляє до конвертера разом з рідким чавуном, також вносить деяку кількість тепла в процес. Згідно з методикою, розрахунок тепла, яке вносить міксерний шлак, виконується за формулою (5.63):
# 
# $$Q_{м.ш} = M_{м.ш} \cdot \frac{a}{100} \cdot (1.53 \cdot t_{м.ш} - 710), \text{ кДж}.$$
# 
# де:
# - $M_{м.ш}$ - маса міксерного шлаку, кг;
# - $a$ - коефіцієнт, що враховує частку міксерного шлаку, %;
# - $t_{м.ш}$ - температура міксерного шлаку (приймається рівною температурі чавуну), °С;
# - $1.53$ і $710$ - коефіцієнти рівняння.
# 
# #### Програмна реалізація розрахунку тепла міксерного шлаку:

# In[35]:


def Q_msh(M_msh, t_msh):
    """
    Розрахунок тепла, що вносить міксерний шлак.

    Параметри:
    M_msh - маса міксерного шлаку, кг
    t_msh - температура міксерного шлаку, °C (зазвичай дорівнює температурі чавуну)

    Повертає:
    Кількість тепла в кДж
    """
    return M_msh * (A_COEF / PERCENT_DIVISOR) * (MSH_COEFFICIENT_1 * t_msh - MSH_OFFSET)


# ### Приклад розрахунку надходження тепла від чавуну і міксерного шлаку

# In[36]:


# Використовуємо вже обраний варіант (selected_variant)
# Розрахунок надходження тепла
Q_chav_val = Q_chav(selected_variant["M_чав"], selected_variant["t_чав"])
Q_msh_val = Q_msh(selected_variant["M_м.ш"], selected_variant["t_чав"])

print(f"\nРозрахунок надходження тепла від чавуну і міксерного шлаку:")
print(f"Фізичне тепло чавуну: Q_чав = {Q_chav_val:.2f} кДж")
print(f"Тепло міксерного шлаку: Q_м.ш = {Q_msh_val:.2f} кДж")


# # Розрахунок теплового балансу киснево-конвертерної плавки
# ## Частина 4: Надходження тепла - окислення домішок та заліза
# 
# ### 4.1 Тепло, що вносить окислення домішок металошихти
# 
# Значна частина тепла в киснево-конвертерному процесі надходить від окислення домішок металошихти (вуглецю, кремнію, марганцю, фосфору). Це основне джерело хімічного тепла процесу. Згідно з методикою, розрахунок тепла, яке вносить окислення домішок, виконується за формулою (5.64):
# 
# $$Q_{дом} = [11680 \cdot (1 - \alpha) + 35300 \cdot \alpha] \cdot (C_{мет.ш} - 0.01 \cdot M_{ст} \cdot C_{пов}) +$$
# $$+ 26930 \cdot Si_{мет.ш} + 7035 \cdot (Mn_{мет.ш} - 0.01 \cdot M_{ст} \cdot Mn_{пов}) +$$
# $$+ 19755 \cdot (P_{мет.ш} - 0.01 \cdot M_{ст} \cdot P_{пов}), \text{ кДж}.$$
# 
# де:
# - $\alpha$ - коефіцієнт, що враховує частку вуглецю, окисленого до CO₂;
# - $C_{мет.ш}, Si_{мет.ш}, Mn_{мет.ш}, P_{мет.ш}$ - маса елементів у металошихті, кг;
# - $C_{пов}, Mn_{пов}, P_{пов}$ - вміст елементів у готовій сталі, %;
# - $M_{ст}$ - маса готової сталі, кг;
# - $11680$ - тепловий ефект окислення вуглецю до CO, кДж/кг;
# - $35300$ - тепловий ефект окислення вуглецю до CO₂, кДж/кг;
# - $26930$ - тепловий ефект окислення кремнію, кДж/кг;
# - $7035$ - тепловий ефект окислення марганцю, кДж/кг;
# - $19755$ - тепловий ефект окислення фосфору, кДж/кг.
# 
# Теплові ефекти реакцій окислення елементів (згідно з Додатками):
# 
# | Реакція | Стандартний тепловий ефект реакції, ккал/кг |
# | :------------------------------------ | :----------------------------------: |
# | $[\text{C}] + \{\text{O}_2\} = \{\text{CO}_2\}$ | 7236 |
# | $[\text{Si}] + \{\text{O}_2\} = \{\text{SiO}_2\}$ | 6075 |
# | $2[\text{P}] + 5/2\{\text{O}_2\} = \{\text{P}_2\text{O}_5\}$ | 3621 |
# | $[\text{C}] + 1/2\{\text{O}_2\} = \{\text{CO}\}$ | 2220 |
# | $[\text{Mn}] + 1/2\{\text{O}_2\} = \{\text{MnO}\}$ | 1390 |
# 
# #### Програмна реалізація розрахунку тепла окислення домішок:

# In[37]:


def Q_dom(C_metsh, M_st, C_pov, Si_metsh, Mn_metsh, Mn_pov, P_metsh, P_pov):
    """
    Розрахунок тепла, що вносить окислення домішок металошихти.

    Параметри:
    C_metsh - маса вуглецю в металошихті, кг
    M_st - маса готової сталі, кг
    C_pov - вміст вуглецю в готовій сталі, %
    Si_metsh - маса кремнію в металошихті, кг
    Mn_metsh - маса марганцю в металошихті, кг
    Mn_pov - вміст марганцю в готовій сталі, %
    P_metsh - маса фосфору в металошихті, кг
    P_pov - вміст фосфору в готовій сталі, %

    Повертає:
    Кількість тепла в кДж
    """
    return (
            (C_TO_CO_HEAT * (1 - ALPHA) + C_TO_CO2_HEAT * ALPHA) * (C_metsh - PERCENT_TO_FRACTION * M_st * C_pov)
            + SI_HEAT * Si_metsh
            + MN_HEAT * (Mn_metsh - PERCENT_TO_FRACTION * M_st * Mn_pov)
            + P_HEAT * (P_metsh - PERCENT_TO_FRACTION * M_st * P_pov)
    )


# ### 4.2 Тепло, що вносить окислення заліза
# 
# Частина заліза в процесі плавки окислюється і переходить у шлак та пил. Це окислення також вносить певний вклад у тепловий баланс. Згідно з методикою, розрахунок тепла, яке вносить окислення заліза, виконується за формулою (5.65):
# 
# $$Q_{Fe} = 0.01 \cdot M_{шл} \cdot [3600 \cdot (FeO) + 5110 \cdot (Fe_2O_3) + 5110 \cdot \chi], \text{ кДж}.$$
# 
# де:
# - $M_{шл}$ - маса шлаку, кг;
# - $(FeO)$ - вміст оксиду заліза FeO у шлаку, %;
# - $(Fe_2O_3)$ - вміст оксиду заліза Fe₂O₃ у шлаку, %;
# - $\chi$ - маса пилу, кг;
# - $3600$ - тепловий ефект утворення FeO, кДж/кг;
# - $5110$ - тепловий ефект утворення Fe₂O₃, кДж/кг.
# 
# Теплові ефекти реакцій окислення заліза (згідно з Додатками):
# 
# | Реакція | Стандартний тепловий ефект реакції, ккал/кг |
# | :------------------------------------ | :----------------------------------: |
# | $2[\text{Fe}] + 3/2\{\text{O}_2\} = \{\text{Fe}_2\text{O}_3\}$ | 1608 |
# | $[\text{Fe}] + 1/2\{\text{O}_2\} = \{\text{FeO}\}$ | 920 |
# | $2\{\text{FeO}\} + 1/2\{\text{O}_2\} = \{\text{Fe}_2\text{O}_3\}$ | 482 |
# 
# #### Програмна реалізація розрахунку тепла окислення заліза:

# In[38]:


def Q_Fe(M_shl, chi):
    """
    Розрахунок тепла, що вносить окислення заліза.

    Параметри:
    M_shl - маса шлаку, кг
    chi - маса пилу, кг

    Повертає:
    Кількість тепла в кДж
    """

    return PERCENT_TO_FRACTION * M_shl * (FEO_HEAT * FEO + FE2O3_HEAT * FE2O3 + FE2O3_HEAT * chi)


# ### Приклад розрахунку надходження тепла від окислення домішок та заліза

# In[39]:


# Використовуємо вже обраний варіант (selected_variant)

# Склад металошихти
C_metsh = 4.3
Si_metsh = 0.4
Mn_metsh = 1.1
P_metsh = 0.18
C_pov = 0.2
Mn_pov = 0.2
P_pov = 0.02

# Розрахунок надходження тепла
Q_dom_val = Q_dom(C_metsh, selected_variant["M_ст"], C_pov, Si_metsh, Mn_metsh, Mn_pov, P_metsh, P_pov)
Q_Fe_val = Q_Fe(selected_variant["M_шл"], selected_variant["M_пил"])

print(f"\nРозрахунок надходження тепла від окислення домішок та заліза:")
print(f"Тепло від окислення домішок: Q_дом = {Q_dom_val:.2f} кДж")
print(f"Тепло від окислення заліза: Q_Fe = {Q_Fe_val:.2f} кДж")


# ## Частина 5: Надходження тепла - шлакоутворення та загальне надходження
# 
# ### 5.1 Тепло шлакоутворення
# 
# Шлакоутворення є важливим процесом в киснево-конвертерній плавці, який також супроводжується виділенням тепла. Згідно з методикою, розрахунок тепла шлакоутворення виконується за формулою (5.66):
# 
# $$Q_{шл} = 0.01 \cdot M_{шл} \cdot [2300 \cdot (SiO_2) + 4886 \cdot (P_2O_5)], \text{ кДж}.$$
# 
# де:
# - $M_{шл}$ - маса шлаку, кг;
# - $(SiO_2)$ - вміст діоксиду кремнію у шлаку, %;
# - $(P_2O_5)$ - вміст пентаоксиду фосфору у шлаку, %;
# - $2300$ - тепловий ефект утворення SiO₂ у шлаку, кДж/кг;
# - $4886$ - тепловий ефект утворення P₂O₅ у шлаку, кДж/кг.
# 
# #### Програмна реалізація розрахунку тепла шлакоутворення:

# In[40]:


def Q_shl(M_shl):
    """
    Розрахунок тепла шлакоутворення.

    Параметри:
    M_shl - маса шлаку, кг

    Повертає:
    Кількість тепла в кДж
    """
    return PERCENT_TO_FRACTION * M_shl * (SIO2_HEAT * SIO2 + P2O5_HEAT * P2O5)


# ### 5.2 Загальне надходження тепла
# 
# Загальне надходження тепла в конвертер складається з усіх вищезгаданих складових. Згідно з методикою, загальне надходження тепла розраховується за формулою (5.67):
# 
# $$Q_{над} = Q_{чав} + Q_{м.ш} + Q_{дом} + Q_{Fe} + Q_{шл}, \text{ кДж}.$$
# 
# де:
# - $Q_{чав}$ - фізичне тепло чавуну, кДж;
# - $Q_{м.ш}$ - тепло міксерного шлаку, кДж;
# - $Q_{дом}$ - тепло окислення домішок, кДж;
# - $Q_{Fe}$ - тепло окислення заліза, кДж;
# - $Q_{шл}$ - тепло шлакоутворення, кДж.
# 
# #### Програмна реалізація розрахунку загального надходження тепла:

# In[41]:


def Q_nad(Q_chav_val, Q_msh_val, Q_dom_val, Q_Fe_val, Q_shl_val):
    """
    Розрахунок загального надходження тепла.

    Параметри:
    Q_chav_val - фізичне тепло чавуну, кДж
    Q_msh_val - тепло міксерного шлаку, кДж
    Q_dom_val - тепло окислення домішок, кДж
    Q_Fe_val - тепло окислення заліза, кДж
    Q_shl_val - тепло шлакоутворення, кДж

    Повертає:
    Загальну кількість тепла в кДж
    """
    return Q_chav_val + Q_msh_val + Q_dom_val + Q_Fe_val + Q_shl_val


# ### Приклад розрахунку тепла шлакоутворення та загального надходження тепла

# In[42]:


# Використовуємо вже обраний варіант (selected_variant)

# Розрахунок тепла шлакоутворення
Q_shl_val = Q_shl(selected_variant["M_шл"])

# Обчислення загального надходження тепла
# (використовуємо результати попередніх розрахунків)
Q_nad_val = Q_nad(Q_chav_val, Q_msh_val, Q_dom_val, Q_Fe_val, Q_shl_val)

print(f"\nРозрахунок тепла шлакоутворення та загального надходження:")
print(f"Тепло шлакоутворення: Q_шл = {Q_shl_val:.2f} кДж")
print(f"Загальне надходження тепла: Q_над = {Q_nad_val:.2f} кДж")


# ## Частина 6: Витрати тепла - рідка сталь і шлак
# 
# ### 6.1 Тепло, що уносить рідка сталь
# 
# Рідка сталь є основним продуктом конвертерної плавки і забирає значну частину тепла. Згідно з методикою, розрахунок тепла, яке уносить рідка сталь, виконується за формулою (5.68):
# 
# $$Q_{ст} = M_{ст} \cdot (54.8 + 0.84 \cdot t_{ст}), \text{ кДж}.$$
# 
# де:
# - $M_{ст}$ - маса рідкої сталі, кг;
# - $t_{ст}$ - температура рідкої сталі, °С;
# - $54.8$ і $0.84$ - коефіцієнти рівняння.
# 
# #### Програмна реалізація розрахунку тепла рідкої сталі:

# In[43]:


def Q_st(M_st, t_st):
    """
    Розрахунок тепла, що уносить рідка сталь.

    Параметри:
    M_st - маса рідкої сталі, кг
    t_st - температура рідкої сталі, °C

    Повертає:
    Кількість тепла в кДж
    """
    return M_st * (ST_COEFFICIENT_1 + ST_COEFFICIENT_2 * t_st)


# ### 6.2 Тепло, що уносить шлак
# 
# Шлак, що утворюється під час плавки, також забирає частину тепла. Згідно з методикою, розрахунок тепла, яке уносить шлак, виконується за формулою (5.69):
# 
# $$Q_{шлаку} = M_{шл} \cdot (2.09 \cdot t_{шл} - 1380), \text{ кДж}.$$
# 
# де:
# - $M_{шл}$ - маса шлаку, кг;
# - $t_{шл}$ - температура шлаку (приймається рівною температурі сталі), °С;
# - $2.09$ і $1380$ - коефіцієнти рівняння.
# 
# #### Програмна реалізація розрахунку тепла шлаку:

# In[44]:


def Q_shlak(M_shl, t_shl):
    """
    Розрахунок тепла, що уносить шлак.

    Параметри:
    M_shl - маса шлаку, кг
    t_shl - температура шлаку, °C

    Повертає:
    Кількість тепла в кДж
    """
    return M_shl * (SHL_COEFFICIENT * t_shl - SHL_OFFSET)


# ### Приклад розрахунку витрат тепла на рідку сталь і шлак

# In[45]:


# Використовуємо вже обраний варіант (selected_variant)

# Розрахунок витрат тепла на рідку сталь
Q_st_val = Q_st(selected_variant["M_ст"], selected_variant["t_ст"])

# Розрахунок витрат тепла на шлак
# Температура шлаку прийнята рівною T_SHL (константа)
Q_shlak_val = Q_shlak(selected_variant["M_шл"], T_SHL)

print(f"\nРозрахунок витрат тепла на рідку сталь і шлак:")
print(f"Тепло, що уносить рідка сталь: Q_ст = {Q_st_val:.2f} кДж")
print(f"Тепло, що уносить шлак: Q_шлаку = {Q_shlak_val:.2f} кДж")


# ## Частина 7: Витрати тепла - конвертерні гази та дисоціація оксидів
# 
# ### 7.1 Тепло, що уносять конвертерні гази
# 
# Під час киснево-конвертерної плавки утворюються гази (в основному CO, CO₂, N₂, O₂), які забирають певну частину тепла. Розрахунок тепла, яке уносять ці гази, потребує визначення їх питомої теплоємності за формулою $c_p = a + bT + cT^{-2}$, де коефіцієнти a, b, c наведені в таблиці для різних газів.
# 
# Згідно з методикою, розрахунок тепла, яке уносять конвертерні гази, виконується за формулою:
# 
# $$Q_{газів} = \sum_i V_{gi} \cdot M_{чав} \cdot \int_{293}^{T_{газу}} c_{pi} \cdot dT \cdot 4.19, \text{ кДж}.$$
# 
# де:
# - $V_{gi}$ - об'єм i-го компоненту газу, м³;
# - $M_{чав}$ - маса чавуну, кг;
# - $c_{pi}$ - питома теплоємність i-го компоненту газу, кал/(моль·К);
# - $T_{газу}$ - температура газу, K;
# - $4.19$ - коефіцієнт переведення калорій в джоулі.
# 
# #### Програмна реалізація розрахунку тепла конвертерних газів:

# In[46]:


def Q_gases(M_chav, T_gas):
    """
    Розрахунок тепла, що уносять конвертерні гази.

    Параметри:
    M_chav - маса чавуну, кг
    T_gas - температура газу, K

    Повертає:
    Кількість тепла в кДж
    """
    Q_gas = 0
    for gas, volume in V_gi.items():
        if gas in gas_coefs:
            a = gas_coefs[gas]['a']
            b = gas_coefs[gas]['b'] * 1e-3  # Переведення в 10⁻³
            c = gas_coefs[gas]['c'] * 1e5  # Переведення в 10⁻⁵

            # Інтеграл від c_p по температурі від 293K до T_gas
            integral = a * (T_gas - 293) + b/2 * (T_gas**2 - 293**2) - c * (1/T_gas - 1/293)

            # Розрахунок тепла для даного газу
            Q_gas += volume * M_chav * integral * 4.19 / MOLAR_VOLUME

    return Q_gas


# ### 7.2 Тепло дисоціації оксидів
# 
# Деякі оксиди, наприклад карбонат кальцію (CaCO₃) у флюсах, за високих температур розкладаються з поглинанням тепла. Це враховується у тепловому балансі. Згідно з методикою, розрахунок тепла дисоціації оксидів виконується за формулою:
# 
# $$Q_{дис} = M_{вап} \cdot \frac{CO_2^{вап}}{100} \cdot 4040, \text{ кДж}.$$
# 
# де:
# - $M_{вап}$ - маса вапна, кг;
# - $CO_2^{вап}$ - вміст CO₂ у вапні, %;
# - $4040$ - теплота дисоціації карбонату кальцію, кДж/кг.
# 
# #### Програмна реалізація розрахунку тепла дисоціації оксидів:

# In[47]:


def Q_dis(M_vap):
    """
    Розрахунок тепла дисоціації оксидів.

    Параметри:
    M_vap - маса вапна, кг

    Повертає:
    Кількість тепла в кДж
    """
    return M_vap * (CO2_VAP / PERCENT_DIVISOR) * CACO3_HEAT


# ### Приклад розрахунку витрат тепла на конвертерні гази та дисоціацію оксидів

# In[48]:


# Використовуємо вже обраний варіант (selected_variant)

# Температура газу (припустимо, 1700 K)
T_gas = 1700  # K

# Маса вапна (припустимо, 5% від маси шлаку)
M_vap = 0.05 * selected_variant["M_шл"]

# Розрахунок витрат тепла на конвертерні гази
Q_gases_val = Q_gases(selected_variant["M_чав"], T_gas)

# Розрахунок витрат тепла на дисоціацію оксидів
Q_dis_val = Q_dis(M_vap)

print(f"\nРозрахунок витрат тепла на конвертерні гази та дисоціацію оксидів:")
print(f"Тепло, що уносять конвертерні гази: Q_газів = {Q_gases_val:.2f} кДж")
print(f"Тепло дисоціації оксидів: Q_дис = {Q_dis_val:.2f} кДж")


# ## Частина 8: Витрати тепла - пил, викиди, корольки та теплові втрати
# 
# ### 8.1 Тепло, що уносить пил
# 
# Під час киснево-конвертерної плавки утворюється пил, який виноситься з газами і забирає частину тепла. Згідно з методикою, розрахунок тепла, яке уносить пил, виконується за формулою (5.70):
# 
# $$Q_{пил} = M_{пил} \cdot \left[23.05 + 0.69 \cdot \frac{(t_{чав} + t_{ст})}{2}\right], \text{ кДж}.$$
# 
# де:
# - $M_{пил}$ - маса пилу, кг;
# - $t_{чав}$ - температура чавуну, °С;
# - $t_{ст}$ - температура сталі, °С;
# - $23.05$ і $0.69$ - коефіцієнти рівняння.
# 
# #### Програмна реалізація розрахунку тепла пилу:

# In[49]:


def Q_pil(M_pil, t_chav, t_st):
    """
    Розрахунок тепла, що уносить пил.

    Параметри:
    M_pil - маса пилу, кг
    t_chav - температура чавуну, °C
    t_st - температура сталі, °C

    Повертає:
    Кількість тепла в кДж
    """
    return M_pil * (PIL_COEFFICIENT_1 + PIL_COEFFICIENT_2 * (t_chav + t_st) / AVERAGE_DIVISOR)


# ### 8.2 Тепло, що уносять викиди, корольки та виплески
# 
# Викиди, корольки в шлаку та виплески металу також забирають частину тепла. Згідно з методикою, розрахунок тепла, яке уносять ці компоненти, виконується за формулою (5.71):
# 
# $$Q_{в.к.в} = Fe_{втр} \cdot \left[54.9 + 0.838 \cdot \frac{(t_{чав} + t_{ст})}{2}\right], \text{ кДж}.$$
# 
# де:
# - $Fe_{втр}$ - маса втрат заліза (викиди, корольки, виплески), кг;
# - $t_{чав}$ - температура чавуну, °С;
# - $t_{ст}$ - температура сталі, °С;
# - $54.9$ і $0.838$ - коефіцієнти рівняння.
# 
# #### Програмна реалізація розрахунку тепла викидів, корольків та виплесків:

# In[50]:


def Q_vkv(Fe_vtr, t_chav, t_st):
    """
    Розрахунок тепла, що уносять викиди, корольки та виплески.

    Параметри:
    Fe_vtr - маса втрат заліза, кг
    t_chav - температура чавуну, °C
    t_st - температура сталі, °C

    Повертає:
    Кількість тепла в кДж
    """
    return Fe_vtr * (VKV_COEFFICIENT_1 + VKV_COEFFICIENT_2 * (t_chav + t_st) / AVERAGE_DIVISOR)


# ### 8.3 Теплові втрати
# 
# Під час киснево-конвертерної плавки завжди існують теплові втрати через теплопровідність, випромінювання тощо. Згідно з методикою, ці втрати приймаються рівними 5% від загального надходження тепла:
# 
# $$Q_{втр} = 0.05 \cdot Q_{над}, \text{ кДж}.$$
# 
# де:
# - $Q_{над}$ - загальне надходження тепла, кДж.
# 
# #### Програмна реалізація розрахунку теплових втрат:

# In[51]:


def Q_vtr(Q_nad):
    """
    Розрахунок теплових втрат.

    Параметри:
    Q_nad - загальне надходження тепла, кДж

    Повертає:
    Кількість тепла в кДж
    """
    return (VTR_PERCENT / PERCENT_DIVISOR) * Q_nad


# ### Приклад розрахунку витрат тепла на пил, викиди, корольки та теплові втрати

# In[52]:


# Використовуємо вже обраний варіант (selected_variant)

# Розрахунок тепла, що уносить пил
Q_pil_val = Q_pil(selected_variant["M_пил"], selected_variant["t_чав"], selected_variant["t_ст"])

# Розрахунок тепла, що уносять викиди, корольки та виплески
Q_vkv_val = Q_vkv(selected_variant["Fe_vtr"], selected_variant["t_чав"], selected_variant["t_ст"])

# Розрахунок теплових втрат
# (використовуємо результат розрахунку загального надходження тепла Q_nad_val)
Q_vtr_val = Q_vtr(Q_nad_val)

print(f"\nРозрахунок витрат тепла на пил, викиди, корольки та теплові втрати:")
print(f"Тепло, що уносить пил: Q_пил = {Q_pil_val:.2f} кДж")
print(f"Тепло, що уносять викиди, корольки та виплески: Q_в.к.в = {Q_vkv_val:.2f} кДж")
print(f"Теплові втрати: Q_втр = {Q_vtr_val:.2f} кДж")


# ## Частина 9: Розрахунок теплового балансу - надлишок/дефіцит
# 
# ### 9.1 Загальні витрати тепла
# 
# Загальні витрати тепла в конвертері складаються з усіх компонентів витрат, розрахованих у попередніх розділах. Згідно з методикою, загальні витрати тепла розраховуються за формулою:
# 
# $$Q_{витр} = Q_{ст} + Q_{шлаку} + Q_{газів} + Q_{дис} + Q_{пил} + Q_{в.к.в} + Q_{втр}, \text{ кДж}.$$
# 
# де:
# - $Q_{ст}$ - тепло, що уносить рідка сталь, кДж;
# - $Q_{шлаку}$ - тепло, що уносить шлак, кДж;
# - $Q_{газів}$ - тепло, що уносять конвертерні гази, кДж;
# - $Q_{дис}$ - тепло дисоціації оксидів, кДж;
# - $Q_{пил}$ - тепло, що уносить пил, кДж;
# - $Q_{в.к.в}$ - тепло, що уносять викиди, корольки та виплески, кДж;
# - $Q_{втр}$ - теплові втрати, кДж.
# 
# #### Програмна реалізація розрахунку загальних витрат тепла:

# In[53]:


def Q_vitr(Q_st_val, Q_shlak_val, Q_gases_val, Q_dis_val, Q_pil_val, Q_vkv_val, Q_vtr_val):
    """
    Розрахунок загальних витрат тепла.

    Параметри:
    Q_st_val - тепло, що уносить рідка сталь, кДж
    Q_shlak_val - тепло, що уносить шлак, кДж
    Q_gases_val - тепло, що уносять конвертерні гази, кДж
    Q_dis_val - тепло дисоціації оксидів, кДж
    Q_pil_val - тепло, що уносить пил, кДж
    Q_vkv_val - тепло, що уносять викиди, корольки та виплески, кДж
    Q_vtr_val - теплові втрати, кДж

    Повертає:
    Загальні витрати тепла в кДж
    """
    return Q_st_val + Q_shlak_val + Q_gases_val + Q_dis_val + Q_pil_val + Q_vkv_val + Q_vtr_val


# ### 9.2 Баланс тепла
# 
# Для визначення теплового стану процесу необхідно порівняти загальне надходження тепла з загальними витратами. Різниця між ними дає надлишок або дефіцит тепла:
# 
# $$\Delta Q = Q_{над} - Q_{витр}, \text{ кДж}.$$
# 
# де:
# - $Q_{над}$ - загальне надходження тепла, кДж;
# - $Q_{витр}$ - загальні витрати тепла, кДж.
# 
# Якщо $\Delta Q > 0$, то в системі є надлишок тепла, якщо $\Delta Q < 0$ - дефіцит тепла.
# 
# #### Програмна реалізація розрахунку балансу тепла:

# In[54]:


def Q_balance(Q_nad_val, Q_vitr_val):
    """
    Розрахунок балансу тепла (надлишок/дефіцит).

    Параметри:
    Q_nad_val - загальне надходження тепла, кДж
    Q_vitr_val - загальні витрати тепла, кДж

    Повертає:
    Надлишок/дефіцит тепла в кДж
    """
    return Q_nad_val - Q_vitr_val


# ### 9.3 Оцінка теплового стану процесу
# 
# Для оцінки теплового стану процесу можна також розрахувати відносний дефіцит/надлишок тепла у відсотках від загального надходження:
# 
# $$\delta Q = \frac{\Delta Q}{Q_{над}} \cdot 100, \text{ \%}.$$
# 
# де:
# - $\Delta Q$ - надлишок/дефіцит тепла, кДж;
# - $Q_{над}$ - загальне надходження тепла, кДж.
# 
# #### Програмна реалізація розрахунку відносного балансу тепла:

# In[55]:


def Q_relative_balance(Q_balance_val, Q_nad_val):
    """
    Розрахунок відносного балансу тепла.

    Параметри:
    Q_balance_val - надлишок/дефіцит тепла, кДж
    Q_nad_val - загальне надходження тепла, кДж

    Повертає:
    Відносний надлишок/дефіцит тепла у відсотках
    """
    return (Q_balance_val / Q_nad_val) * 100


# ### Приклад розрахунку теплового балансу

# In[56]:


# Використовуємо результати попередніх розрахунків

# Розрахунок загальних витрат тепла
Q_vitr_val = Q_vitr(Q_st_val, Q_shlak_val, Q_gases_val, Q_dis_val, Q_pil_val, Q_vkv_val, Q_vtr_val)

# Розрахунок балансу тепла
Q_balance_val = Q_balance(Q_nad_val, Q_vitr_val)

# Розрахунок відносного балансу тепла
Q_relative_balance_val = Q_relative_balance(Q_balance_val, Q_nad_val)

print(f"\nРозрахунок теплового балансу:")
print(f"Загальне надходження тепла: Q_над = {Q_nad_val:.2f} кДж")
print(f"Загальні витрати тепла: Q_витр = {Q_vitr_val:.2f} кДж")
print(f"Баланс тепла (надлишок/дефіцит): ΔQ = {Q_balance_val:.2f} кДж")
print(f"Відносний баланс тепла: δQ = {Q_relative_balance_val:.2f} %")

# Визначення теплового стану процесу
if Q_balance_val > 0:
    print("\nУ системі є надлишок тепла.")
    if Q_relative_balance_val > 10:
        print("Значний надлишок тепла може призвести до перегріву металу.")
    else:
        print("Надлишок тепла в допустимих межах.")
elif Q_balance_val < 0:
    print("\nУ системі є дефіцит тепла.")
    if Q_relative_balance_val < -10:
        print("Значний дефіцит тепла може призвести до недостатньої температури металу.")
    else:
        print("Дефіцит тепла в допустимих межах.")
else:
    print("\nТепловий баланс ідеально збалансований.")


# ## Частина 10: Розрахунок коригуючих добавок та висновки
# 
# ### 10.1 Визначення потреби в коригуючих добавках
# 
# Якщо в процесі киснево-конвертерної плавки виявлено значний дефіцит або надлишок тепла, необхідно вжити заходів для корекції теплового балансу. Це можна зробити за допомогою коригуючих добавок.
# 
# При дефіциті тепла ($\Delta Q < 0$) можна використовувати такі теплоносії:
# - Карбід кремнію (SiC)
# - Карбід кальцію (CaC₂)
# - Антрацит
# - Піролізована біомаса
# 
# При надлишку тепла ($\Delta Q > 0$) можна використовувати охолоджуючі добавки:
# - Залізна руда
# - Окатиші
# - Металевий брухт
# 
# #### Розрахунок кількості теплоносіїв при дефіциті тепла
# 
# Маса теплоносія, необхідна для компенсації дефіциту тепла, розраховується за формулою:
# 
# $$M_{тепл} = \frac{|\Delta Q|}{Q_{пит}}, \text{ кг}.$$
# 
# де:
# - $\Delta Q$ - дефіцит тепла (від'ємне значення), кДж;
# - $Q_{пит}$ - питомий тепловий ефект від згоряння теплоносія, кДж/кг.
# 
# #### Програмна реалізація розрахунку кількості теплоносіїв:

# In[57]:


def calculate_heat_additive(Q_balance_val, heat_effect):
    """
    Розрахунок кількості теплоносія для компенсації дефіциту тепла.

    Параметри:
    Q_balance_val - баланс тепла (від'ємне значення при дефіциті), кДж
    heat_effect - питомий тепловий ефект теплоносія, кДж/кг

    Повертає:
    Необхідну масу теплоносія в кг
    """
    if Q_balance_val >= 0:
        return 0  # Немає дефіциту тепла

    return abs(Q_balance_val) / heat_effect


# ### Розрахунок кількості охолоджуючих добавок при надлишку тепла
# 
# Маса охолоджуючої добавки, необхідна для компенсації надлишку тепла, розраховується за формулою:
# 
# $$M_{охол} = \frac{\Delta Q}{c \cdot \Delta T}, \text{ кг}.$$
# 
# де:
# - $\Delta Q$ - надлишок тепла (додатне значення), кДж;
# - $c$ - питома теплоємність добавки, кДж/(кг·°C);
# - $\Delta T$ - різниця між температурою плавки та початковою температурою добавки, °C.
# 
# #### Програмна реалізація розрахунку кількості охолоджуючих добавок:

# In[58]:


def calculate_cooling_additive(Q_balance_val, specific_heat, delta_T):
    """
    Розрахунок кількості охолоджуючої добавки для компенсації надлишку тепла.

    Параметри:
    Q_balance_val - баланс тепла (додатне значення при надлишку), кДж
    specific_heat - питома теплоємність добавки, кДж/(кг·°C)
    delta_T - різниця температур, °C

    Повертає:
    Необхідну масу охолоджуючої добавки в кг
    """
    if Q_balance_val <= 0:
        return 0  # Немає надлишку тепла

    return Q_balance_val / (specific_heat * delta_T)


# ### 10.2 Приклад розрахунку коригуючих добавок

# In[59]:


# Використовуємо результати розрахунку теплового балансу
# Q_balance_val - надлишок/дефіцит тепла, кДж

# Визначення теплового стану процесу та необхідних добавок
if Q_balance_val < 0:
    # При дефіциті тепла розраховуємо необхідну кількість теплоносіїв
    print("\nУ системі виявлено дефіцит тепла. Розрахунок теплоносіїв:")

    m_sic = calculate_heat_additive(Q_balance_val, SIC_HEAT)
    m_cac2 = calculate_heat_additive(Q_balance_val, CAC2_HEAT)
    m_coal = calculate_heat_additive(Q_balance_val, COAL_HEAT)
    m_biomass = calculate_heat_additive(Q_balance_val, BIOMASS_HEAT)

    print(f"Для компенсації дефіциту тепла можна використати один з наступних теплоносіїв:")
    print(f"- Карбід кремнію (SiC): {m_sic:.2f} кг")
    print(f"- Карбід кальцію (CaC₂): {m_cac2:.2f} кг")
    print(f"- Антрацит: {m_coal:.2f} кг")
    print(f"- Піролізована біомаса: {m_biomass:.2f} кг")

elif Q_balance_val > 0:
    # При надлишку тепла розраховуємо необхідну кількість охолоджуючих добавок
    print("\nУ системі виявлено надлишок тепла. Розрахунок охолоджуючих добавок:")

    # Приблизні значення для розрахунку
    c_scrap = 0.6  # кДж/(кг·°C)
    c_ore = 0.9  # кДж/(кг·°C)
    delta_T_scrap = 1300  # °C (різниця між температурою плавки і початковою температурою брухту)
    delta_T_ore = 1400  # °C (різниця між температурою плавки і початковою температурою руди)

    m_scrap = calculate_cooling_additive(Q_balance_val, c_scrap, delta_T_scrap)
    m_ore = calculate_cooling_additive(Q_balance_val, c_ore, delta_T_ore)

    print(f"Для компенсації надлишку тепла можна використати одну з наступних охолоджуючих добавок:")
    print(f"- Металевий брухт: {m_scrap:.2f} кг")
    print(f"- Залізна руда/окатиші: {m_ore:.2f} кг")
else:
    print("\nТепловий баланс ідеально збалансований. Коригуючі добавки не потрібні.")


# ### 10.3 Висновки щодо теплового балансу конвертерної плавки
# 
# Тепловий баланс киснево-конвертерної плавки є важливим інструментом для аналізу та оптимізації процесу виробництва сталі. Він дозволяє:
# 
# 1. Оцінити ефективність використання тепла в конвертері
# 2. Визначити необхідність введення теплоносіїв або охолоджуючих добавок
# 3. Оптимізувати витрати енергії та матеріалів
# 4. Забезпечити потрібну температуру металу на випуску
# 
# Основні висновки щодо теплового балансу конвертерної плавки:

# In[60]:


# Візуалізація структури надходження тепла
import matplotlib.pyplot as plt

heat_sources = ['Фізичне тепло чавуну', 'Тепло міксерного шлаку',
                'Тепло окислення домішок', 'Тепло окислення заліза',
                'Тепло шлакоутворення']
heat_values = [Q_chav_val, Q_msh_val, Q_dom_val, Q_Fe_val, Q_shl_val]

# Розрахунок відсотків
heat_percentages = [val / Q_nad_val * 100 for val in heat_values]

print("\nСтруктура надходження тепла:")
for source, value, percentage in zip(heat_sources, heat_values, heat_percentages):
    print(f"{source}: {value:.2f} кДж ({percentage:.2f}%)")

# Аналогічно для витрат тепла
heat_sinks = ['Тепло рідкої сталі', 'Тепло шлаку', 'Тепло конвертерних газів',
              'Тепло дисоціації оксидів', 'Тепло пилу',
              'Тепло викидів, корольків, виплесків', 'Теплові втрати']
sink_values = [Q_st_val, Q_shlak_val, Q_gases_val, Q_dis_val,
               Q_pil_val, Q_vkv_val, Q_vtr_val]

# Розрахунок відсотків
sink_percentages = [val / Q_vitr_val * 100 for val in sink_values]

print("\nСтруктура витрат тепла:")
for sink, value, percentage in zip(heat_sinks, sink_values, sink_percentages):
    print(f"{sink}: {value:.2f} кДж ({percentage:.2f}%)")

print("\nЗагальний висновок:")
if abs(Q_relative_balance_val) <= 5:
    print("Тепловий баланс близький до оптимального.")
elif Q_relative_balance_val > 5:
    print("Система має надлишок тепла, рекомендується використання охолоджуючих добавок.")
else:
    print("Система має дефіцит тепла, рекомендується використання теплоносіїв.")

