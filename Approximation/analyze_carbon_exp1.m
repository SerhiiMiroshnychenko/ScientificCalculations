%% Аналіз залежності вмісту вуглецю від розміру фракцій (Експеримент №1)
% Цей скрипт виконує аналіз експериментальних даних для визначення залежності
% вмісту вуглецю від розміру фракцій в агломераційній шихті.
%
% Виконуються наступні типи апроксимації:
% 1. Поліноміальні (лінійна, квадратична, кубічна, 4-го ступеню)
% 2. Експоненціальна (y = a*exp(b*x))
% 3. Логарифмічна (y = a*log(x) + b)
% 4. Степенева (y = a*x^b)
%
% Для кожного типу апроксимації розраховується коефіцієнт детермінації R²,
% який показує, наскільки добре модель описує експериментальні дані.
% R² змінюється від 0 до 1, де 1 означає ідеальну відповідність.

%% Вхідні дані
% Розміри фракцій (мм) - середнє значення для кожного діапазону
% Для діапазону >10 мм беремо значення 11 мм як середнє значення
% Розміри фракцій (середнє значення для кожного діапазону)
x = [11; 10.4; 8.5; 5.3; 3.1; 0.5];  % приблизні середні значення діапазонів

% Значення вмісту вуглецю для експерименту №1
C = [1.79; 2.88; 3.11; 3.66; 4.35; 4.42];

%% Налаштування графічного вікна
% Створюємо нове вікно розміром 800x600 пікселів
figure('Position', [100 100 800 600]);

% Будуємо експериментальні точки
% 'bo' - сині кружечки
% MarkerSize - розмір маркерів
% LineWidth - товщина ліній
% DisplayName - ім'я для легенди
plot(x, C, 'bo', 'MarkerSize', 10, 'LineWidth', 1.5, 'DisplayName', 'Експериментальні дані')
hold on

%% Створення точок для побудови кривих апроксимації
% Створюємо 100 точок між мінімальним і максимальним значенням x
x_fit = linspace(min(x), max(x), 100);

%% Поліноміальні апроксимації
% polyfit повертає коефіцієнти полінома в порядку спадання степенів
% Лінійна: a*x + b
% Квадратична: a*x^2 + b*x + c
% Кубічна: a*x^3 + b*x^2 + c*x + d
% 4-го ступеню: a*x^4 + b*x^3 + c*x^2 + d*x + e
p1 = polyfit(x, C, 1);  % лінійна
p2 = polyfit(x, C, 2);  % квадратична
p3 = polyfit(x, C, 3);  % кубічна
p4 = polyfit(x, C, 4);  % 4-го ступеню

%% Додаткові типи апроксимації
% Налаштування початкових значень для уникнення попереджень
% і покращення збіжності алгоритму

% Експоненціальна апроксимація (a*exp(b*x))
fo_exp = fitoptions('exp1');
fo_exp.StartPoint = [3.0 -0.1];  % Початкові значення для a*exp(b*x)

% Логарифмічна апроксимація (a*log(x)+b)
fo_log = fitoptions('Method', 'NonlinearLeastSquares');
fo_log.StartPoint = [-0.5 4];  % Початкові значення для a*log(x)+b

% Степенева апроксимація (a*x^b)
fo_pow = fitoptions('power1');
fo_pow.StartPoint = [3.0 -0.1];  % Початкові значення для a*x^b

% Створення об'єктів апроксимації
f_exp = fit(x, C, 'exp1', fo_exp);
f_log = fit(x, C, 'a*log(x)+b', fo_log);
f_pow = fit(x, C, 'power1', fo_pow);

% Будуємо криві апроксимації
plot(x_fit, polyval(p1, x_fit), 'k--', 'LineWidth', 1.5, 'DisplayName', 'Лінійна')
plot(x_fit, polyval(p2, x_fit), 'm-.', 'LineWidth', 1.5, 'DisplayName', 'Квадратична')
plot(x_fit, polyval(p3, x_fit), 'c-', 'LineWidth', 1.5, 'DisplayName', 'Кубічна')
plot(x_fit, polyval(p4, x_fit), 'y-', 'LineWidth', 1.5, 'DisplayName', '4-го ступеню')
plot(x_fit, f_exp(x_fit), '--', 'Color', [0.5 0 0.5], 'LineWidth', 1.5, 'DisplayName', 'Експоненціальна')
plot(x_fit, f_log(x_fit), '-.', 'Color', [0 0.5 0], 'LineWidth', 1.5, 'DisplayName', 'Логарифмічна')
plot(x_fit, f_pow(x_fit), ':', 'Color', [0.8 0.4 0], 'LineWidth', 1.5, 'DisplayName', 'Степенева')

% Налаштування графіка
title('Залежність вмісту вуглецю від розміру фракції (Експеримент №1)', 'FontSize', 14)
xlabel('Розмір фракції, мм', 'FontSize', 12)
ylabel('Вміст вуглецю, %', 'FontSize', 12)
grid on
legend('Location', 'best', 'FontSize', 10)
grid minor

%% Виведення рівнянь апроксимації
fprintf('\nРівняння залежності вмісту вуглецю (Експеримент №1):\n')
fprintf('1. Поліноміальні апроксимації:\n')
fprintf('Лінійне: C = %.4fx + %.4f\n', p1(1), p1(2))
fprintf('Квадратичне: C = %.4fx^2 + %.4fx + %.4f\n', p2(1), p2(2), p2(3))
fprintf('Кубічне: C = %.4fx^3 + %.4fx^2 + %.4fx + %.4f\n', p3(1), p3(2), p3(3), p3(4))
fprintf('4-го ступеню: C = %.4fx^4 + %.4fx^3 + %.4fx^2 + %.4fx + %.4f\n', p4(1), p4(2), p4(3), p4(4), p4(5))

fprintf('\n2. Додаткові типи апроксимації:\n')
fprintf('Експоненціальна: C = %.4f * exp(%.4fx)\n', f_exp.a, f_exp.b)
fprintf('Логарифмічна: C = %.4f * log(x) + %.4f\n', f_log.a, f_log.b)
fprintf('Степенева: C = %.4f * x^(%.4f)\n', f_pow.a, f_pow.b)

%% Розрахунок коефіцієнтів детермінації (R²)
% R² = 1 - SS_res/SS_tot
% де SS_res - сума квадратів залишків
% SS_tot - загальна сума квадратів
y_mean = mean(C); % Середнє значення експериментальних даних
SS_tot = sum((C - y_mean).^2); % Загальна сума квадратів

% Розрахунок передбачених значень для кожної моделі
y_pred_1 = polyval(p1, x);  % Лінійна
y_pred_2 = polyval(p2, x);  % Квадратична
y_pred_3 = polyval(p3, x);  % Кубічна
y_pred_4 = polyval(p4, x);  % 4-го ступеню
y_pred_exp = f_exp(x);      % Експоненціальна
y_pred_log = f_log(x);      % Логарифмічна
y_pred_pow = f_pow(x);      % Степенева

% Розрахунок R² для кожної моделі
R2_1 = 1 - sum((C - y_pred_1).^2)/SS_tot;
R2_2 = 1 - sum((C - y_pred_2).^2)/SS_tot;
R2_3 = 1 - sum((C - y_pred_3).^2)/SS_tot;
R2_4 = 1 - sum((C - y_pred_4).^2)/SS_tot;
R2_exp = 1 - sum((C - y_pred_exp).^2)/SS_tot;
R2_log = 1 - sum((C - y_pred_log).^2)/SS_tot;
R2_pow = 1 - sum((C - y_pred_pow).^2)/SS_tot;

%% Виведення результатів
fprintf('\nКоефіцієнти детермінації (R^2):\n')
fprintf('1. Для поліноміальних апроксимацій:\n')
fprintf('Лінійна: %.4f\n', R2_1)
fprintf('Квадратична: %.4f\n', R2_2)
fprintf('Кубічна: %.4f\n', R2_3)
fprintf('4-го ступеню: %.4f\n', R2_4)

fprintf('\n2. Для додаткових типів апроксимації:\n')
fprintf('Експоненціальна: %.4f\n', R2_exp)
fprintf('Логарифмічна: %.4f\n', R2_log)
fprintf('Степенева: %.4f\n', R2_pow)

% Зберігаємо графік
savefig('carbon_analysis_exp1.fig')
print('carbon_analysis_exp1', '-dpng', '-r300')
