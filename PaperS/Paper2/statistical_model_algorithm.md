# Алгоритм статистичної моделі прогнозування

Цей документ містить аналіз алгоритму статистичної моделі прогнозування, реалізованої в скрипті `скріпт-2.py`.

## Укрупнена діаграма алгоритму

```mermaid
flowchart TD
    A[Початок] --> B[Налаштування логування]
    B --> C[Завантаження та попередня обробка даних]
    C --> D[Розбиття на тренувальну і тестову вибірки]
    D --> E[Навчання статистичної моделі]
    
    subgraph TrainModel["Навчання моделі"]
        E1[Аналіз статистичної значущості колонок] --> E2[Відбір значущих колонок]
        E2 --> E3[Визначення порогових значень]
        E3 --> E4[Розрахунок ваг факторів]
    end
    
    E --> TrainModel
    TrainModel --> F[Прогнозування на тестовій вибірці]
    F --> G[Оцінка якості моделі]
    G --> H[Візуалізація результатів]
    H --> I[Збереження результатів моделі]
    I --> Z[Кінець]
```

## Деталізація основних вузлів

### 1. Завантаження та попередня обробка даних

```mermaid
flowchart TD
    A[Завантаження даних] --> B[Зчитування CSV-файлу]
    B --> C[Перетворення цільової колонки на цілі числа]
    C --> D[Підрахунок розподілу цільової змінної]
    D --> E[Вибір числових колонок для аналізу]
    E --> F{Є від'ємні значення?}
    F -- Так --> G[Заміна від'ємних значень нулями]
    F -- Ні --> H{Є пропущені значення?}
    G --> H
    H -- Так --> I[Обробка пропущених значень]
    H -- Ні --> J[Повернення обробленого DataFrame]
    I --> J
```

### 2. Розбиття на тренувальну і тестову вибірки

```mermaid
flowchart TD
    A[Початок розбиття] --> B[Стратифіковане розбиття за цільовою змінною]
    B --> C[Обчислення розміру вибірок]
    C --> D[Аналіз розподілу цільової змінної у вибірках]
    D --> E[Логування результатів розбиття]
    E --> F[Повернення тренувальної та тестової вибірок]
```

### 3. Аналіз статистичної значущості колонок

```mermaid
flowchart TD
    A[Початок аналізу колонки] --> B{Достатньо даних для аналізу?}
    B -- Ні --> C[Позначити колонку як незначущу]
    B -- Так --> D[Оцінка нормальності розподілу]
    D --> E{Обидві групи мають нормальний розподіл?}
    
    E -- Так --> F[Виконати параметричний аналіз\nt-тест, розрахунок Cohen's d]
    E -- Ні --> G[Виконати непараметричний аналіз\nMann-Whitney U тест, розрахунок AUC]
    
    F --> H{p-значення ≤ 0.05?}
    G --> H
    
    H -- Так --> I[Визначити напрямок впливу і пороги]
    H -- Ні --> C
    
    I --> J[Повернути результати аналізу значущості]
    C --> J
```

### 4. Оцінка нормальності розподілу

```mermaid
flowchart TD
    A[Початок оцінки нормальності] --> B[Поділ даних на дві групи]
    B --> C[Розрахунок базової статистики для кожної групи]
    C --> D[Виконання тесту Шапіро-Вілка]
    D --> E[Виконання тесту Д'Агостіно-Пірсона]
    E --> F[Виконання тесту Андерсона-Дарлінга]
    
    F --> G[Підрахунок кількості тестів, що підтверджують нормальність]
    G --> H{Принаймні 2 тести підтверджують нормальність для обох груп?}
    
    H -- Так --> I[Рекомендувати параметричний метод]
    H -- Ні --> J[Рекомендувати непараметричний метод]
    
    I --> K[Повернути результати оцінки нормальності]
    J --> K
```

### 5. Навчання статистичної моделі

```mermaid
flowchart TD
    A[Початок навчання моделі] --> B[Аналіз кожної числової колонки]
    B --> C[Виявлення статистично значущих колонок]
    C --> D[Розрахунок ваги для кожної значущої ознаки]
    D --> E[Сортування ознак за важливістю]
    E --> F[Формування моделі з параметрами]
    F --> G[Повернення навченої моделі]
```

### 6. Прогнозування з використанням статистичної моделі

```mermaid
flowchart TD
    A[Отримання тестової вибірки і моделі] --> B[Копіювання тестових даних]
    
    B --> C[Поцикловий аналіз кожної значущої колонки]
    C --> D[Визначення чи перевищує значення поріг для кожного спостереження]
    D --> E{Напрямок впливу колонки?}
    
    E -- "Більше → Успіх" --> F[Голос за успіх, якщо значення > порогу]
    E -- "Менше → Успіх" --> G[Голос за успіх, якщо значення < порогу]
    
    F --> H[Зважування голосу відповідно до ваги колонки]
    G --> H
    
    H --> I[Сумування зважених голосів усіх колонок]
    I --> J[Нормалізація для отримання ймовірності]
    J --> K[Класифікація на основі порогу]
    K --> L[Повернення прогнозів і ймовірностей]
```

### 7. Оцінка якості моделі

```mermaid
flowchart TD
    A[Отримання фактичних і прогнозованих значень] --> B[Розрахунок базових метрик]
    B --> C[Створення матриці помилок]
    C --> D[Розрахунок специфічності і NPV]
    D --> E[Логування результатів]
    E --> F[Повернення метрик ефективності]
    
    subgraph BasicMetrics[Базові метрики]
        B1[Точність\nAccuracy] 
        B2[Precision]
        B3[Повнота\nRecall]
        B4[F1-міра]
        B5[ROC AUC]
    end
```

### 8. Візуалізація результатів

```mermaid
flowchart TD
    A[Отримання тестових даних і прогнозів] --> B[Створення ROC-кривої]
    B --> C[Створення матриці помилок]
    C --> D[Створення гістограми розподілу ймовірностей]
    D --> E{Доступна інформація про важливість ознак?}
    E -- Так --> F[Візуалізація важливості ознак]
    E -- Ні --> G[Збереження створених візуалізацій]
    F --> G
    G --> H[Повернення шляхів до збережених графіків]
```

## Діаграма параметричного і непараметричного порівняння груп

### Параметричний аналіз

```mermaid
flowchart TD
    A[Початок параметричного аналізу] --> B[Welch's t-test]
    B --> C[Розрахунок Cohen's d як міри розміру ефекту]
    C --> D[Розрахунок 95% довірчого інтервалу]
    D --> E{p-значення ≤ 0.05?}
    E -- Так --> F[Різниця статистично значуща]
    E -- Ні --> G[Різниця статистично незначуща]
    F --> H[Інтерпретація розміру ефекту]
    G --> H
    H --> I[Повернення результатів аналізу]
```

### Непараметричний аналіз

```mermaid
flowchart TD
    A[Початок непараметричного аналізу] --> B[Mann-Whitney U тест]
    B --> C[Розрахунок AUC як міри розміру ефекту]
    C --> D[Корекція напрямку AUC]
    D --> E[Розрахунок різниці медіан]
    E --> F{p-значення <= 0.05?}
    F -- Так --> G[Різниця статистично значуща]
    F -- Ні --> H[Різниця статистично незначуща]
    G --> I[Інтерпретація розміру ефекту AUC]
    H --> I
    I --> J[Повернення результатів аналізу]
```

## Повний потік виконання основної функції

```mermaid
flowchart TD
    A[Початок main] --> B[Налаштування логування]
    B --> C[Завантаження даних з файлу]
    C --> D[Вибір числових колонок]
    D --> E[Розбиття на тренувальну та тестову вибірки]
    E --> F[Навчання статистичної моделі]
    F --> G[Прогнозування на тестовій вибірці]
    G --> H[Оцінка якості моделі]
    H --> I[Створення візуалізацій]
    I --> J[Збереження результатів моделі]
    J --> K[Логування успішного завершення]
    K --> L[Кінець main]
    
    M[Виняток на етапі] -.-> N[Логування помилки]
    N -.-> O[Підняття винятку вище]
```
