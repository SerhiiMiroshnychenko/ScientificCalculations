# Виклад основного матеріалу дослідження

## Методологія дослідження

### Загальний опис даних

Для проведення дослідження було сформовано вибірку історичних даних про замовлення за період 2017-2025 років. Вибірка охоплює 86794 замовлення від 7849 клієнтів у B2B-сегменті. Кожне замовлення класифіковано як успішне (завершене) або неуспішне (скасоване або відхилене), причому 54763 замовлення (63,1%) є успішними, а 32031 замовлення (36,9%) – неуспішними.

Для кожного замовлення зібрано 19 числових характеристик, які потенційно можуть впливати на його успішність. Ці характеристики можна розподілити на кілька категорій:

1. **Характеристики замовлення**:
   - order_amount – сума замовлення
   - order_lines_count – кількість позицій у замовленні
   - order_messages – кількість повідомлень у замовленні
   - order_changes – кількість змін у замовленні
   - discount_total – загальна сума знижки
   - hour_of_day – година створення замовлення
   - quarter – квартал, в якому створено замовлення

2. **Характеристики замовника**:
   - partner_total_orders – загальна кількість замовлень клієнта
   - partner_success_rate – відсоток успішних замовлень клієнта
   - partner_total_messages – загальна кількість повідомлень клієнта
   - partner_order_age_days – середній вік замовлень клієнта в днях
   - partner_avg_amount – середня сума замовлення клієнта
   - partner_avg_changes – середня кількість змін на замовлення клієнта

3. **Окремі характеристики для успішних та неуспішних замовлень клієнта**:
   - partner_success_avg_amount – середня сума успішних замовлень клієнта
   - partner_success_avg_messages – середня кількість повідомлень в успішних замовленнях клієнта
   - partner_success_avg_changes – середня кількість змін в успішних замовленнях клієнта
   - partner_fail_avg_amount – середня сума неуспішних замовлень клієнта
   - partner_fail_avg_messages – середня кількість повідомлень в неуспішних замовленнях клієнта
   - partner_fail_avg_changes – середня кількість змін в неуспішних замовленнях клієнта

### Підготовка даних

Для забезпечення якості аналізу проведено попередню обробку даних, яка включала:

1. **Перевірку та обробку від'ємних значень**. Виявлені від'ємні значення в числових колонках було замінено нулями, оскільки в контексті даного аналізу від'ємні значення не мають змістовної інтерпретації.

2. **Перевірку та обробку пропущених значень**. Розраховано кількість та відсоток пропущених значень для кожної колонки. Для колонок з невеликим відсотком пропущених значень (менше 5%) застосовано заповнення середніми значеннями, а колонки з високим відсотком пропусків було виключено з аналізу.

3. **Виявлення та обробку викидів**. Для виявлення викидів використано метод міжквартильного діапазону (IQR), який є робастним до негаусівського розподілу даних. Значення вважалися викидами, якщо вони виходили за межі [Q1 - 1.5*IQR; Q3 + 1.5*IQR], де Q1 та Q3 – перший та третій квартилі відповідно, а IQR = Q3 - Q1. Виявлені викиди було оброблено методом обмеження (capping), тобто замінено на граничні значення допустимого діапазону.

4. **Розподіл даних на тренувальну та тестову вибірки**. Для забезпечення об'єктивності оцінки якості моделі дані було розподілено на тренувальну (70%) та тестову (30%) вибірки із збереженням пропорції успішних та неуспішних замовлень у кожній вибірці.

### Методика статистичного аналізу

Для визначення статистичної значущості кожного фактора у розрізненні успішних та неуспішних замовлень розроблено комплексну методику, яка автоматично обирає відповідні статистичні методи залежно від характеристик розподілу даних. Ця методика включає такі етапи:

1. **Оцінка нормальності розподілу даних** у групах успішних та неуспішних замовлень. Для цього використано кілька статистичних тестів:
   - Тест Шапіро-Вілка, який є одним з найпотужніших тестів на нормальність для вибірок розміром до 5000 спостережень
   - Тест Д'Агостіно-Пірсона, який оцінює нормальність на основі асиметрії та ексцесу розподілу
   - Тест Андерсона-Дарлінга, який є особливо чутливим до відхилень у хвостах розподілу

   Для великих вибірок (понад 5000 спостережень) застосовувалася випадкова підвибірка для тесту Шапіро-Вілка. Нормальність розподілу вважалася підтвердженою, якщо p-значення для всіх тестів перевищувало рівень значущості α = 0.05.

2. **Вибір відповідного статистичного методу** для порівняння груп:
   - Для нормально розподілених даних застосовувався параметричний t-тест Стьюдента для незалежних вибірок, який оцінює статистичну значущість різниці середніх значень між групами
   - Для даних, що не відповідають нормальному розподілу, використовувався непараметричний U-тест Манна-Вітні, який порівнює розподіли значень у групах без припущення про їхню форму

3. **Розрахунок розміру ефекту** для кількісної оцінки впливу фактора на успішність замовлення:
   - Для параметричного аналізу розраховувався коефіцієнт d Коена, який вимірює стандартизовану різницю між середніми значеннями груп
   - Для непараметричного аналізу розраховувався показник AUC (Area Under Curve), який відображає ймовірність того, що випадково обране значення з групи успішних замовлень буде більшим за випадково обране значення з групи неуспішних замовлень

4. **Визначення порогових значень** для кожного значущого фактора за допомогою аналізу ROC-кривих. Оптимальне порогове значення визначалося як точка на ROC-кривій, що максимізує суму чутливості та специфічності.

5. **Розрахунок ваги кожного фактора** на основі розміру ефекту та статистичної значущості. Цей показник використовується для ранжування факторів за їхнім впливом на успішність замовлення та для побудови прогностичної моделі.

### Розробка прогностичної моделі

На основі результатів статистичного аналізу розроблено прогностичну модель для оцінки ймовірності успішності замовлення. Модель базується на зважених внесках кожного фактора, де ваги пропорційні розміру ефекту фактора:

1. Для кожного замовлення і та фактора j розраховується нормалізований показник f_{i,j}, який відображає положення значення фактора відносно порогового значення t_j:
   
   f_{i,j} = (x_{i,j} - t_j) / σ_j * sign_j
   
   де x_{i,j} – значення фактора j для замовлення i, σ_j – стандартне відхилення фактора j, sign_j – напрямок впливу фактора (1, якщо більші значення відповідають вищій ймовірності успіху, та -1 у протилежному випадку).

2. Загальний прогностичний показник P_i для замовлення i розраховується як зважена сума нормалізованих показників по всіх факторах:
   
   P_i = ∑_j (w_j * f_{i,j})
   
   де w_j – вага фактора j, пропорційна його розміру ефекту.

3. Ймовірність успішності замовлення p_i розраховується за допомогою сигмоїдної функції:
   
   p_i = 1 / (1 + e^(-P_i))

Для валідації моделі використано тестову вибірку, на якій розраховано такі метрики якості:
- Точність (Accuracy) – частка правильно класифікованих замовлень
- Повнота (Recall) – частка правильно ідентифікованих успішних замовлень
- Точність у вузькому сенсі (Precision) – частка правильно ідентифікованих замовлень серед усіх, класифікованих як успішні
- F1-міра – гармонічне середнє повноти та точності у вузькому сенсі
- AUC-ROC – площа під ROC-кривою, яка відображає якість класифікації при різних порогових значеннях
