# 5. Непараметричні методи порівняння груп

Непараметричні методи статистичного аналізу є невід'ємною складовою сучасного аналізу даних, особливо в контексті роботи з реальними бізнес-даними, де припущення про нормальність розподілу часто не виконується. На відміну від параметричних методів, непараметричні не потребують специфічних припущень про форму розподілу даних, що робить їх більш універсальними та робастними до викидів і аномалій. У рамках запропонованої системи прогнозування успішності замовлень непараметричні методи застосовуються для тих факторів, де тестування виявило відхилення від нормальності розподілу принаймні в одній із груп.

Основним непараметричним методом, що використовується у системі, є U-тест Манна-Уітні, який базується на рангах спостережень і дозволяє виявляти відмінності не лише в центральних тенденціях, а й у загальному розподілі значень між двома незалежними вибірками.

### U-тест Манна-Уітні

U-тест Манна-Уітні (також відомий як критерій Вілкоксона-Манна-Уітні) — це непараметричний статистичний тест, який використовується для перевірки гіпотези про відмінності між двома незалежними вибірками. На відміну від t-тесту, який порівнює середні значення, U-тест порівнює розподіл рангів спостережень у двох групах.

Алгоритм U-тесту Манна-Уітні включає наступні кроки:

1. Об'єднання даних із обох груп в один набір
2. Ранжування об'єднаного набору від найменшого до найбільшого значення
3. Повернення до початкового поділу на групи і обчислення суми рангів для кожної групи
4. Обчислення U-статистики за формулою:

$$U_1 = n_1 \times n_2 + \frac{n_1 \times (n_1 + 1)}{2} - R_1$$

$$U_2 = n_1 \times n_2 + \frac{n_2 \times (n_2 + 1)}{2} - R_2$$

де $n_1$ та $n_2$ — розміри груп, а $R_1$ та $R_2$ — суми рангів у групах.

5. Вибір мінімального значення з $U_1$ та $U_2$ в якості тестової статистики U.

У випадку великих вибірок (зазвичай n > 20) розподіл U-статистики наближається до нормального з математичним очікуванням та дисперсією:

$$E(U) = \frac{n_1 \times n_2}{2}$$

$$Var(U) = \frac{n_1 \times n_2 \times (n_1 + n_2 + 1)}{12}$$

Це дозволяє обчислити стандартизовану z-статистику:

$$z = \frac{U - E(U)}{\sqrt{Var(U)}}$$

і визначити p-значення тесту на основі стандартного нормального розподілу.

У контексті прогнозування успішності замовлень нульова гіпотеза $H_0$ полягає в тому, що розподіли значень певного фактора не відрізняються між групами успішних та неуспішних замовлень. Альтернативна гіпотеза $H_1$ припускає наявність відмінностей у розподілах. Якщо p-значення тесту не перевищує встановлений рівень значущості $\alpha$ (зазвичай 0.05), нульова гіпотеза відхиляється, що свідчить про статистично значущу відмінність між групами за даним фактором.

### Розмір ефекту: AUC (площа під ROC-кривою)

Для непараметричних тестів традиційною мірою розміру ефекту є AUC (Area Under Curve) — площа під ROC-кривою, яка має прямий зв'язок зі статистикою U тесту Манна-Уітні. AUC можна інтерпретувати як ймовірність того, що випадково обране спостереження з першої групи матиме більше значення, ніж випадково обране спостереження з другої групи.

Формула для обчислення AUC на основі U-статистики має вигляд:

$$AUC = \frac{U}{n_1 \times n_2}$$

де $U$ — значення статистики Манна-Уітні, а $n_1$ та $n_2$ — розміри груп.

Значення AUC лежать у діапазоні від 0 до 1, де:
- AUC = 0.5: відсутність відмінностей між групами (розподіли ідентичні)
- AUC < 0.5: значення у першій групі схильні бути меншими, ніж у другій
- AUC > 0.5: значення у першій групі схильні бути більшими, ніж у другій

Для зручності інтерпретації результатів у запропонованій системі прогнозування AUC нормалізується таким чином, щоб значення більше 0.5 завжди вказували на позитивний вплив фактора на успішність замовлення, а значення менше 0.5 — на негативний. Така нормалізація досягається шляхом трансформації:

$$AUC_{norm} = 
\begin{cases} 
AUC & \text{якщо медіана у групі успішних замовлень більша} \\
1 - AUC & \text{якщо медіана у групі успішних замовлень менша}
\end{cases}$$

Величина відхилення $AUC_{norm}$ від 0.5 визначає силу ефекту: чим далі значення від 0.5, тим сильніший ефект. Для інтерпретації розміру ефекту використовуються наступні рекомендації:
- |AUC - 0.5| < 0.1: незначний ефект
- 0.1 ≤ |AUC - 0.5| < 0.2: малий ефект
- 0.2 ≤ |AUC - 0.5| < 0.3: середній ефект
- |AUC - 0.5| ≥ 0.3: великий ефект

### Довірчий інтервал для AUC

Для підвищення надійності оцінки розміру ефекту важливо обчислювати не лише точкову оцінку AUC, а й довірчий інтервал. 95% довірчий інтервал для AUC може бути обчислений з використанням методу ДеЛонга або за допомогою бутстрепінгу. У запропонованій системі довірчий інтервал обчислюється за формулою:

$$AUC_{lower} = AUC - 1.96 \times SE_{AUC}$$
$$AUC_{upper} = AUC + 1.96 \times SE_{AUC}$$

де $SE_{AUC}$ — стандартна помилка оцінки AUC, яка може бути апроксимована як:

$$SE_{AUC} \approx \sqrt{\frac{AUC \times (1 - AUC) + (n_1 - 1) \times (Q_1 - AUC^2) + (n_2 - 1) \times (Q_2 - AUC^2)}{n_1 \times n_2}}$$

де $Q_1$ та $Q_2$ — ймовірності конкордантності пари спостережень у першій та другій групах відповідно.

### Застосування у системі прогнозування

У запропонованій системі прогнозування успішності замовлень непараметричні методи застосовуються для тих факторів, де перевірка нормальності розподілу виявила відхилення від нормального розподілу принаймні в одній із груп. Для кожного такого фактора виконуються наступні кроки:

1. Проведення U-тесту Манна-Уітні для визначення статистичної значущості відмінностей між групами
2. Обчислення нормалізованої AUC як міри розміру ефекту
3. Розрахунок 95% довірчого інтервалу для AUC
4. Визначення напрямку впливу фактора на успішність замовлень
5. Інтерпретація результатів з урахуванням як p-значення, так і розміру ефекту

Фактори, для яких виявлено статистично значущі відмінності (p ≤ 0.05), включаються до моделі прогнозування з ваговим коефіцієнтом, що базується на розмірі ефекту (нормалізованій AUC). Чим більше відхилення AUC від 0.5, тим більша вага фактора у моделі.

Таким чином, непараметричні методи порівняння груп забезпечують статистично обґрунтоване виявлення значущих факторів та кількісну оцінку їхнього впливу на успішність замовлень навіть у випадках, коли розподіл даних відхиляється від нормального, що є критично важливим для забезпечення надійності та універсальності прогностичної моделі.
