# 6. Розрахунок вагових коефіцієнтів факторів

Визначення вагових коефіцієнтів факторів є критично важливим етапом у побудові статистичної моделі прогнозування успішності замовлень. Вагові коефіцієнти відображають відносну важливість кожного фактора у прогнозі та забезпечують диференційований вплив факторів з різною силою ефекту на кінцевий результат. Правильно розраховані вагові коефіцієнти дозволяють максимізувати прогностичну точність моделі та забезпечити її стійкість до варіацій у даних.

У запропонованій системі прогнозування вага кожного фактора визначається на основі розміру ефекту, отриманого за результатами статистичного порівняння груп успішних та неуспішних замовлень. Залежно від використаного методу порівняння груп (параметричного чи непараметричного) застосовуються різні підходи до розрахунку вагових коефіцієнтів.

### Розрахунок ваг для факторів з параметричним аналізом

Для факторів, де було застосовано параметричний аналіз (t-тест Велша), вага визначається на основі стандартизованого розміру ефекту — d Коена. Пряме використання значення d Коена в якості ваги може бути проблематичним, оскільки теоретично воно може набувати довільних значень, у той час як для моделі бажано мати обмежений діапазон вагових коефіцієнтів.

Для нормалізації ваги застосовується гіперболічний тангенс (tanh) — функція, яка обмежує вихідні значення діапазоном від -1 до 1, зберігаючи при цьому монотонність та відносну силу впливу факторів. Формула для розрахунку ваги параметричного фактора має вигляд:

$$w = tanh(|d|)$$

де $d$ — значення d Коена для даного фактора.

Використання модуля забезпечує, що вага завжди є додатною, незалежно від напрямку впливу фактора. Напрямок впливу (позитивний чи негативний) враховується на етапі прогнозування окремо від ваги, через визначення чи перевищення фактором порогового значення збільшує чи зменшує ймовірність успішного замовлення.

Функція $tanh(x)$ має наступні властивості, що роблять її ідеальною для нормалізації вагових коефіцієнтів:
- Обмеженість: $-1 < tanh(x) < 1$ для всіх $x$
- Монотонність: функція строго зростає на всій області визначення
- Нелінійна компресія: для малих значень аргументу функція близька до лінійної, а для великих значень — асимптотично наближається до 1

Таким чином, фактори з незначним розміром ефекту отримують пропорційно малу вагу, а фактори з великим розміром ефекту отримують високу, але обмежену вагу, що запобігає надмірному впливу окремих факторів на загальний прогноз.

### Розрахунок ваг для факторів з непараметричним аналізом

Для факторів, де було застосовано непараметричний аналіз (тест Манна-Уітні), вага визначається на основі нормалізованого значення AUC (площі під ROC-кривою). Оскільки AUC вже обмежена діапазоном від 0 до 1, де 0.5 відповідає відсутності ефекту, для нормалізації ваги застосовується трансформація, що масштабує відхилення AUC від 0.5 до діапазону [0, 1]:

$$w = 2 \times |AUC - 0.5|$$

де $AUC$ — нормалізоване значення площі під ROC-кривою.

Множник 2 забезпечує, що максимальне можливе значення ваги (при $AUC = 0$ або $AUC = 1$) дорівнює 1, що узгоджується з максимальним значенням ваги для параметричних факторів.

Така трансформація має наступні переваги:
- Забезпечує нульову вагу для факторів без ефекту ($AUC = 0.5$)
- Пропорційно збільшує вагу зі збільшенням відхилення AUC від 0.5
- Обмежує максимальну вагу значенням 1, що узгоджується з ваговими коефіцієнтами для параметричних факторів
- Зберігає монотонну залежність між силою статистичного ефекту та вагою фактора

### Інтеграція вагових коефіцієнтів у модель прогнозування

Розраховані вагові коефіцієнти використовуються у моделі прогнозування для зваженого врахування впливу кожного фактора на кінцевий прогноз. Для кожного спостереження (потенційного замовлення) модель аналізує значення кожного значущого фактора, порівнюючи його з визначеним пороговим значенням. Залежно від результату порівняння та встановленого напрямку впливу, фактор "голосує" за успішність чи неуспішність замовлення. Голос кожного фактора зважується відповідним ваговим коефіцієнтом, що забезпечує більший вплив факторів з сильнішим статистичним ефектом.

Формально, процес прогнозування можна описати наступним чином. Для кожного спостереження $x$ та кожного значущого фактора $f_i$ з ваговим коефіцієнтом $w_i$, пороговим значенням $t_i$ та встановленим напрямком впливу $d_i$ обчислюється внесок фактора $v_i$:

$$v_i = 
\begin{cases} 
w_i & \text{якщо } (x[f_i] > t_i \text{ і } d_i = 1) \text{ або } (x[f_i] < t_i \text{ і } d_i = -1) \\
0 & \text{в іншому випадку}
\end{cases}$$

де $d_i = 1$ означає, що більші значення фактора асоціюються з успішністю, а $d_i = -1$ — що з успішністю асоціюються менші значення.

Загальна оцінка успішності $S$ для спостереження $x$ визначається як сума зважених внесків усіх факторів, нормалізована сумою всіх вагових коефіцієнтів:

$$S(x) = \frac{\sum_{i=1}^{n} v_i}{\sum_{i=1}^{n} w_i}$$

Отримана оцінка $S(x)$ представляє собою ймовірність успішності замовлення і лежить у діапазоні від 0 до 1. Для бінарної класифікації застосовується пороговий критерій (зазвичай 0.5), де спостереження з $S(x) \geq 0.5$ класифікуються як успішні, а з $S(x) < 0.5$ — як неуспішні.

### Переваги запропонованого підходу до розрахунку вагових коефіцієнтів

Запропонований підхід до розрахунку вагових коефіцієнтів має ряд переваг, що роблять його особливо ефективним у контексті прогнозування успішності замовлень:

1. **Інтерпретованість**: Вагові коефіцієнти безпосередньо пов'язані з розміром статистичного ефекту, що забезпечує чітку інтерпретацію впливу кожного фактора на прогноз.

2. **Адаптивність**: Підхід адаптується до характеру розподілу даних, використовуючи різні методи розрахунку для параметричних та непараметричних факторів.

3. **Збалансованість**: Нормалізація вагових коефіцієнтів запобігає надмірному впливу окремих факторів на загальний прогноз, забезпечуючи стабільність моделі.

4. **Статистична обґрунтованість**: Використання стандартних мір розміру ефекту (d Коена та AUC) забезпечує статистичну обґрунтованість вагових коефіцієнтів.

5. **Універсальність**: Підхід однаково ефективний для різних типів даних та розподілів, що робить його універсальним для застосування у різних бізнес-контекстах.

6. **Масштабованість**: Модель природньо масштабується при додаванні нових факторів, оскільки нормалізація вагових коефіцієнтів забезпечує їх співставність.

Таким чином, запропонована методологія розрахунку вагових коефіцієнтів забезпечує статистично обґрунтований, інтерпретований та адаптивний підхід до оцінки важливості факторів у прогнозуванні успішності замовлень, що є ключовою складовою ефективної прогностичної моделі.
