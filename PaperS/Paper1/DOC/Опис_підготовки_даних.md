# Методологія підготовки даних для дослідження прогнозування успішності замовлень

## Вступ

Підготовка даних є критичним етапом, що значною мірою визначає ефективність подальшого аналізу та моделювання. У контексті даного дослідження підготовка даних набуває особливого значення через необхідність трансформації різнорідних ознак для побудови точних предиктивних моделей прогнозування успішності замовлень. Метою даного розділу є детальний опис методологічних підходів та технік, застосованих для обробки вихідного набору даних, а також обґрунтування вибору конкретних методів підготовки даних відповідно до їх характеристик та вимог подальшого моделювання.

## Характеристика вихідного набору даних

Вихідний набір даних складається з 86794 записів, що містять інформацію про замовлення з 25 характеристиками (ознаками). Серед них цільова змінна `is_successful`, що визначає успішність виконання замовлення (бінарна класифікація: 1 - успішне замовлення, 0 - неуспішне). Набір даних охоплює період з липня 2017 року по січень 2025 року та включає різноманітні типи даних: числові (11 з плаваючою точкою, 9 цілочисельних) та категоріальні (5 об'єктних).

Початковий аналіз розподілу цільової змінної виявив певну незбалансованість класів – приблизно 63% замовлень є успішними, що вимагає особливої уваги при подальшому моделюванні. Попередня статистика (мінімальні, максимальні, середні значення, медіани, квартилі) вказує на значну дисперсію в числових ознаках та наявність екстремальних значень, особливо в показниках вартості замовлень (`order_amount`), де спостерігаються значення від -6242,4 до 4140000,0, а також у характеристиках історії партнерів.

## Методологія попередньої обробки даних

### Обробка часових характеристик

Змінна `create_date`, що відображає дату та час створення замовлення, була трансформована з метою виділення темпоральних компонентів для виявлення можливих часових залежностей. Було виокремлено такі характеристики: день тижня, місяць, квартал та година доби. Таке перетворення дозволяє виявити потенційні сезонні коливання та циклічність у процесах оформлення замовлень.

Для циклічних темпоральних характеристик, таких як день тижня, місяць та година доби, було застосовано техніку циклічного кодування за допомогою синусоїдальних та косинусоїдальних трансформацій. Дана техніка забезпечує належне відображення циклічної природи часових змінних. Наприклад, для дня тижня, де значення 7 (неділя) логічно близьке до значення 1 (понеділок), традиційне числове кодування створило б штучну віддаленість цих значень. Циклічне кодування через тригонометричні функції вирішує цю проблему, забезпечуючи коректне представлення часових циклів у багатовимірному просторі ознак.

Формально, для кожної циклічної змінної x з максимальним значенням max_val створюються дві нові змінні:
- x_sin = sin(2π × x / max_val)
- x_cos = cos(2π × x / max_val)

Це перетворення було реалізовано за допомогою бібліотеки feature_engine (CyclicalFeatures), що забезпечує стандартизоване та ефективне конвертування циклічних змінних.

Також на основі `create_date` було створено параметр `create_date_months`.

Величина create_date_months репрезентує часову віддаленість моменту створення конкретного замовлення від початкової точки спостережень, вимірювану в місяцях, де за початкову точку приймається дата першого зафіксованого в системі замовлення.

Це перетворення дозволяє представити часовий ряд у вигляді монотонно зростаючої числової послідовності, що відображає часову відстань між замовленнями в місяцях. Така трансформація є особливо цінною для виявлення довгострокових трендів та сезонних патернів у даних про замовлення.

Змінна create_date_months може бути використана як регресор у моделях машинного навчання для врахування часових залежностей та еволюції характеристик замовлень з плином часу. Крім того, ця змінна забезпечує можливість аналізу динаміки успішності замовлень у часовій перспективі, що може виявити важливі бізнес-інсайти щодо сезонності та довгострокових тенденцій.

### Обробка категоріальних змінних

Категоріальні змінні, такі як `salesperson` (відповідальний за продаж) та `source` (джерело замовлення), вимагали спеціальної обробки для їх інтеграції у математичні моделі. Аналіз унікальних значень виявив помірну кардинальність змінної salesperson (31 унікальне значення) та дещо вищу кардинальність для source (66 унікальних значень).

Для категоріальних змінних було застосовано метод кодування Label Encoding, що передбачає заміну категоріальних значень на числові індекси. Вибір саме цього методу кодування обумовлений значною кардинальністю змінних, що робить техніки One-Hot Encoding потенційно неефективним через створення значної кількості додаткових бінарних змінних, що може призвести до розрідженості даних і надмірного збільшення розмірності простору ознак.; 

Формально, Label Encoding перетворює категоріальну змінну X з k унікальними значеннями {c₁, c₂, ..., cₖ} на числову змінну X' з відповідними числовими значеннями {0, 1, ..., k-1}. Це перетворення було реалізовано за допомогою класу LabelEncoder з бібліотеки scikit-learn.

### Обробка числових змінних та масштабування

Числові змінні у наборі даних характеризуються значною варіативністю масштабів та присутністю екстремальних значень (викидів). Зокрема, такі змінні як `order_amount` (сума замовлення), `partner_total_orders` (загальна кількість замовлень партнера), `partner_avg_amount` (середня сума замовлень партнера) мають широкий діапазон значень та асиметричний розподіл, що підтверджується статистичними тестами.

Для нормалізації числових змінних було застосовано RobustScaler – метод масштабування, стійкий до викидів. Цей метод був обраний через його ефективність при роботі з даними, що містять екстремальні значення. На відміну від стандартного масштабування (StandardScaler), що використовує середнє значення та стандартне відхилення, RobustScaler використовує медіану та міжквартильний розмах для центрування та масштабування даних:

X' = (X - медіана(X)) / (Q₃(X) - Q₁(X))

де X – вихідна змінна, X' – перетворена змінна, Q₁(X) та Q₃(X) – перший та третій квартилі змінної X відповідно.

Такий підхід значно зменшує вплив екстремальних значень на результат масштабування, що особливо важливо для змінних з вираженою асиметрією розподілу, як у випадку з `order_amount`. Зазначимо, що тест Д'Агостіно-Пірсона для змінної `order_amount` показав статистичну значущість відхилення від нормального розподілу (p-value < 0.05), що додатково підтверджує доцільність використання стійких до викидів методів нормалізації.

### Виявлення та обробка викидів

Для виявлення викидів у числових змінних було використано метод міжквартильного розмаху (IQR) – робастну статистичну методику, що визначає викиди на основі відстані від квартилів розподілу. Значення вважаються викидами, якщо вони знаходяться за межами інтервалу [Q₁ - 1.5×IQR, Q₃ + 1.5×IQR], де IQR = Q₃ - Q₁.

Аналіз викидів за цим методом виявив значну кількість екстремальних значень в таких змінних як `order_amount`, `partner_avg_amount`, `partner_success_avg_amount` та `order_lines_count`. Враховуючи потенційний інформаційний вміст цих викидів для прогнозування успішності замовлень, було прийнято рішення не видаляти їх, а застосувати техніки стійкого масштабування (описані вище) для мінімізації їхнього впливу на модель.

## Формування фінального набору даних

Після проведення всіх етапів попередньої обробки було сформовано фінальний набір даних, готовий для подальшого моделювання. Він містить трансформовані та масштабовані ознаки, що відображають як оригінальні характеристики замовлень, так і додатково створені на основі них темпоральні та циклічні змінні.

Фінальний набір даних включає 86792 спостереження (два записи було видалено через відсутність значень у певних полях) та 30 ознак. Цільова змінна `is_successful` зберігає свій оригінальний бінарний формат, при цьому її розподіл відповідає початковому – приблизно 63% записів відносяться до класу успішних замовлень.

## Висновки

Описана методологія підготовки даних забезпечує комплексну трансформацію вихідного набору даних у формат, оптимальний для застосування методів машинного навчання. Ключовими аспектами розробленого підходу є: (1) спеціалізована обробка темпоральних характеристик через циклічне кодування, (2) ефективне перетворення категоріальних змінних з урахуванням їх кардинальності, (3) робастне масштабування числових змінних для мінімізації впливу викидів.

Обрані методи обробки даних відповідають специфіці аналізованого набору та вимогам подальшого моделювання, зокрема, враховують наявність циклічних змінних, високу кардинальність категоріальних ознак та присутність екстремальних значень у числових змінних. Таким чином, створено надійну основу для побудови предиктивних моделей прогнозування успішності замовлень.
