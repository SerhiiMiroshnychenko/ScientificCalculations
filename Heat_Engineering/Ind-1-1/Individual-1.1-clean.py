"""
Розрахунок водоохолоджуваної панелі ДСП
Варіант 25
"""
import math

# 1. Вхідні дані з таблиці 1.1 для варіанту 25
q = 200  # тепловий потік, кВт/м²
d = 89/1000  # зовнішній діаметр труби, м
d1 = 65/1000  # внутрішній діаметр труби, м
n_90 = 4  # кількість поворотів на 90°
n_180 = 6  # кількість поворотів на 180°
t_in = 25  # температура води на вході, °С
P_wat = 0.39  # тиск води в цеху, МПа
material = "Сталь Ст20"

# Константи з умов розрахунку
t1 = 75  # температура стінки водяного каналу панелі, °С
t_out = 55  # температура води на виході, °С
dP_g = 0  # статичні втрати тиску, Па

# Фізичні константи
lambda_st20 = 39  # теплопровідність сталі Ст20, Вт/(м·К)
lambda_cu = 370  # теплопровідність міді, Вт/(м·К)
rho = 1000  # щільність води, кг/м³
C = 4200  # теплоємність води, Дж/(кг·К)
nu = 1e-6  # коефіцієнт кінематичної в'язкості води, м²/с
mu_fr = 0.045  # коефіцієнт тертя води в трубі
xi_lr1 = 0.22  # коефіцієнт місцевого опору поворот на 90°
xi_lr2 = 0.31  # коефіцієнт місцевого опору поворот на 180°

# Вибір теплопровідності матеріалу
lambda_pipe = lambda_st20 if material == "Сталь Ст20" else lambda_cu

# 2. Розрахунок максимальної довжини змійовика
# Приймаємо початкову швидкість води
w = 0.5  # м/с

# Розрахунок довжини змійовика за формулою (1.7)
L = (w * rho * math.pi * (d1**2/4) * C * (t_out - t_in)) / (q * 1000 * math.pi * (d/2))

# Перевірка умови довжини (10-30 м) та корекція швидкості якщо потрібно
while L < 10 or L > 30:
    if L < 10:
        w += 0.1
    else:
        w -= 0.1
    L = (w * rho * math.pi * (d1**2/4) * C * (t_out - t_in)) / (q * 1000 * math.pi * (d/2))

print(f"\n1. Розрахована довжина змійовика: {L:.2f} м")
print(f"   Швидкість води: {w:.2f} м/с")

# 3. Розрахунок температури робочої поверхні за формулою (1.8)
t2 = t1 + (q * 1000 * math.log(d/d1)) / (2 * math.pi * lambda_pipe)
print(f"t2 = {t2:.2f}")

# Перевірка температурних обмежень
t2_max = 450 if material == "Сталь Ст20" else 260
print(f"{t2_max = }")

print(f"\n2. Температура зовнішньої поверхні змійовика: {t2:.2f} °С")
print(f"   Максимально допустима температура: {t2_max:.2f} °С")
if t2 > t2_max:
    print(f"   УВАГА! Перевищення допустимої температури на {t2 - t2_max:.2f} °С")

# 4. Розрахунок втрат тиску
# Втрати на тертя за формулою (1.9)
dP_fr = mu_fr * (L/d1) * rho * (w**2/2)
print(f"dP_fr = {dP_fr:.2f}")

# Місцеві втрати за формулою (1.10)
dP_lr = (n_90 * xi_lr1 + n_180 * xi_lr2) * rho * (w**2/2)
print(f"dP_lr = {dP_lr:.2f}")

# Сумарні втрати за формулою (1.12)
dP_loss = dP_fr + dP_lr + dP_g
print(f"dP_lr = {dP_loss:.2f}")

# Перевірка достатності тиску води
P_wat_min = (dP_loss + 1e5)/1e6  # МПа
print(f"P_wat_min = {P_wat_min:.2f}")

print("\n3. Втрати тиску:")
print(f"   - на тертя: {dP_fr/1000:.2f} кПа")
print(f"   - місцеві: {dP_lr/1000:.2f} кПа")
print(f"   - сумарні: {dP_loss/1000:.2f} кПа")
print(f"   Мінімально необхідний тиск води: {P_wat_min:.2f} МПа")
print(f"   Наявний тиск води: {P_wat:.2f} МПа")
if P_wat < P_wat_min:
    print(f"   УВАГА! Недостатній тиск води. Потрібно збільшити на {(P_wat_min - P_wat):.2f} МПа")

# 5. Перевірка всіх обмежень
print("\n4. Перевірка обмежень:")
print(f"   1) Температура стінки водяного каналу: {t1} °С {'≤' if t1 <= 75 else '>'} 75 °С")
print(f"   2) Температура води на виході: {t_out} °С {'≤' if t_out <= 55 else '>'} 55 °С")
print(f"   3) Температура зовнішньої поверхні: {t2:.1f} °С {'≤' if t2 <= t2_max else '>'} {t2_max} °С")
print(f"   4) Довжина змійовика: {L:.1f} м {'в межах' if 10 <= L <= 30 else 'поза межами'} 10-30 м")
print(f"   5) Тиск води: {P_wat} МПа {'≥' if P_wat >= P_wat_min else '<'} {P_wat_min:.2f} МПа")
